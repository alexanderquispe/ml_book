<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 16 Inference on Predictive and Causal Effects in High-Dimensional Nonlinear Models | Machine Learning and Causal Inference</title>
  <meta name="description" content="Chapter 16 Inference on Predictive and Causal Effects in High-Dimensional Nonlinear Models | Machine Learning and Causal Inference" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 16 Inference on Predictive and Causal Effects in High-Dimensional Nonlinear Models | Machine Learning and Causal Inference" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 16 Inference on Predictive and Causal Effects in High-Dimensional Nonlinear Models | Machine Learning and Causal Inference" />
  
  
  

<meta name="author" content="Alexander Quispe &amp; Anzony Quispe" />


<meta name="date" content="2021-11-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-effect-of-gun-ownership-on-gun-homicide-rates-using-dml-for-neural-nets.html"/>
<link rel="next" href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Machine Learning and Causal Inference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="predictive-inference.html"><a href="predictive-inference.html"><i class="fa fa-check"></i><b>2</b> Predictive Inference</a>
<ul>
<li class="chapter" data-level="2.1" data-path="predictive-inference.html"><a href="predictive-inference.html#data"><i class="fa fa-check"></i><b>2.1</b> Data</a></li>
<li class="chapter" data-level="2.2" data-path="predictive-inference.html"><a href="predictive-inference.html#data-analysis"><i class="fa fa-check"></i><b>2.2</b> Data Analysis</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="predictive-inference.html"><a href="predictive-inference.html#r-and-python-code"><i class="fa fa-check"></i><b>2.2.1</b> R and Python code</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="predictive-inference.html"><a href="predictive-inference.html#prediction-question"><i class="fa fa-check"></i><b>2.3</b> Prediction Question</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="predictive-inference.html"><a href="predictive-inference.html#basic-model"><i class="fa fa-check"></i><b>2.3.1</b> Basic Model:</a></li>
<li class="chapter" data-level="2.3.2" data-path="predictive-inference.html"><a href="predictive-inference.html#flexible-model"><i class="fa fa-check"></i><b>2.3.2</b> Flexible Model:</a></li>
<li class="chapter" data-level="2.3.3" data-path="predictive-inference.html"><a href="predictive-inference.html#lasso-model"><i class="fa fa-check"></i><b>2.3.3</b> Lasso Model:</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="predictive-inference.html"><a href="predictive-inference.html#data-splitting"><i class="fa fa-check"></i><b>2.4</b> Data Splitting</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="predictive-inference-the-gender-wage-gap.html"><a href="predictive-inference-the-gender-wage-gap.html"><i class="fa fa-check"></i><b>3</b> Predictive Inference The Gender Wage Gap</a>
<ul>
<li class="chapter" data-level="3.1" data-path="predictive-inference-the-gender-wage-gap.html"><a href="predictive-inference-the-gender-wage-gap.html#data-analysis-1"><i class="fa fa-check"></i><b>3.1</b> Data analysis</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="predictive-inference-the-gender-wage-gap.html"><a href="predictive-inference-the-gender-wage-gap.html#ols-regression"><i class="fa fa-check"></i><b>3.1.1</b> OLS Regression</a></li>
<li class="chapter" data-level="3.1.2" data-path="predictive-inference-the-gender-wage-gap.html"><a href="predictive-inference-the-gender-wage-gap.html#ols-regression-with-controls"><i class="fa fa-check"></i><b>3.1.2</b> Ols regression with controls</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="predictive-inference-the-gender-wage-gap.html"><a href="predictive-inference-the-gender-wage-gap.html#partialling-out-using-ols"><i class="fa fa-check"></i><b>3.2</b> Partialling-Out using ols</a></li>
<li class="chapter" data-level="3.3" data-path="predictive-inference-the-gender-wage-gap.html"><a href="predictive-inference-the-gender-wage-gap.html#partialling-out-using-lasso"><i class="fa fa-check"></i><b>3.3</b> Partialling-Out using lasso</a></li>
<li class="chapter" data-level="3.4" data-path="predictive-inference-the-gender-wage-gap.html"><a href="predictive-inference-the-gender-wage-gap.html#extra-flexible-model"><i class="fa fa-check"></i><b>3.4</b> “Extra” flexible model</a></li>
<li class="chapter" data-level="3.5" data-path="predictive-inference-the-gender-wage-gap.html"><a href="predictive-inference-the-gender-wage-gap.html#laso-extra-flexible-model"><i class="fa fa-check"></i><b>3.5</b> Laso “Extra” Flexible model</a></li>
<li class="chapter" data-level="3.6" data-path="predictive-inference-the-gender-wage-gap.html"><a href="predictive-inference-the-gender-wage-gap.html#summarize-the-results"><i class="fa fa-check"></i><b>3.6</b> Summarize the results</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="simple-exercise-on-overfitting.html"><a href="simple-exercise-on-overfitting.html"><i class="fa fa-check"></i><b>4</b> Simple Exercise on Overfitting</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simple-exercise-on-overfitting.html"><a href="simple-exercise-on-overfitting.html#first-set-pn"><i class="fa fa-check"></i><b>4.1</b> 1. First set p=n</a></li>
<li class="chapter" data-level="4.2" data-path="simple-exercise-on-overfitting.html"><a href="simple-exercise-on-overfitting.html#second-set-pn2."><i class="fa fa-check"></i><b>4.2</b> 2. Second, set p=n/2.</a></li>
<li class="chapter" data-level="4.3" data-path="simple-exercise-on-overfitting.html"><a href="simple-exercise-on-overfitting.html#third-set-pn-.05"><i class="fa fa-check"></i><b>4.3</b> 3. Third, set p/n =.05</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="vaccine-rct-examples.html"><a href="vaccine-rct-examples.html"><i class="fa fa-check"></i><b>5</b> Vaccine RCT Examples</a>
<ul>
<li class="chapter" data-level="5.1" data-path="vaccine-rct-examples.html"><a href="vaccine-rct-examples.html#polio-rct"><i class="fa fa-check"></i><b>5.1</b> Polio RCT</a></li>
<li class="chapter" data-level="5.2" data-path="vaccine-rct-examples.html"><a href="vaccine-rct-examples.html#pfizerbntx-covid-19-rct"><i class="fa fa-check"></i><b>5.2</b> Pfizer/BNTX Covid-19 RCT</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="penalized-linear-regressions-a-simulation-experiment.html"><a href="penalized-linear-regressions-a-simulation-experiment.html"><i class="fa fa-check"></i><b>6</b> Penalized Linear Regressions: A Simulation Experiment</a>
<ul>
<li class="chapter" data-level="6.1" data-path="penalized-linear-regressions-a-simulation-experiment.html"><a href="penalized-linear-regressions-a-simulation-experiment.html#data-generating-process-approximately-sparse"><i class="fa fa-check"></i><b>6.1</b> Data Generating Process: Approximately Sparse</a></li>
<li class="chapter" data-level="6.2" data-path="penalized-linear-regressions-a-simulation-experiment.html"><a href="penalized-linear-regressions-a-simulation-experiment.html#data-generating-process-approximately-sparse-small-dense-part"><i class="fa fa-check"></i><b>6.2</b> Data Generating Process: Approximately Sparse + Small Dense Part</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="simulation-design.html"><a href="simulation-design.html"><i class="fa fa-check"></i><b>7</b> Simulation Design</a>
<ul>
<li class="chapter" data-level="7.1" data-path="simulation-design.html"><a href="simulation-design.html#example-1"><i class="fa fa-check"></i><b>7.1</b> Example 1</a></li>
<li class="chapter" data-level="7.2" data-path="simulation-design.html"><a href="simulation-design.html#example-2"><i class="fa fa-check"></i><b>7.2</b> Example 2</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="testing-the-convergence-hypothesis.html"><a href="testing-the-convergence-hypothesis.html"><i class="fa fa-check"></i><b>8</b> Testing the Convergence Hypothesis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="testing-the-convergence-hypothesis.html"><a href="testing-the-convergence-hypothesis.html#introduction"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="testing-the-convergence-hypothesis.html"><a href="testing-the-convergence-hypothesis.html#data-analysis-2"><i class="fa fa-check"></i><b>8.2</b> Data analysis</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="testing-the-convergence-hypothesis.html"><a href="testing-the-convergence-hypothesis.html#ols"><i class="fa fa-check"></i><b>8.2.1</b> OLS</a></li>
<li class="chapter" data-level="8.2.2" data-path="testing-the-convergence-hypothesis.html"><a href="testing-the-convergence-hypothesis.html#lasso"><i class="fa fa-check"></i><b>8.2.2</b> Lasso</a></li>
<li class="chapter" data-level="8.2.3" data-path="testing-the-convergence-hypothesis.html"><a href="testing-the-convergence-hypothesis.html#summary-results"><i class="fa fa-check"></i><b>8.2.3</b> Summary results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="machine-learning-for-wage-prediction.html"><a href="machine-learning-for-wage-prediction.html"><i class="fa fa-check"></i><b>9</b> Machine Learning for wage prediction</a>
<ul>
<li class="chapter" data-level="9.1" data-path="machine-learning-for-wage-prediction.html"><a href="machine-learning-for-wage-prediction.html#data-1"><i class="fa fa-check"></i><b>9.1</b> Data</a></li>
<li class="chapter" data-level="9.2" data-path="machine-learning-for-wage-prediction.html"><a href="machine-learning-for-wage-prediction.html#analysis"><i class="fa fa-check"></i><b>9.2</b> Analysis</a></li>
<li class="chapter" data-level="9.3" data-path="machine-learning-for-wage-prediction.html"><a href="machine-learning-for-wage-prediction.html#ols-1"><i class="fa fa-check"></i><b>9.3</b> OLS</a></li>
<li class="chapter" data-level="9.4" data-path="machine-learning-for-wage-prediction.html"><a href="machine-learning-for-wage-prediction.html#lasso-ridge-and-elastic-net"><i class="fa fa-check"></i><b>9.4</b> Lasso, Ridge and Elastic Net</a></li>
<li class="chapter" data-level="9.5" data-path="machine-learning-for-wage-prediction.html"><a href="machine-learning-for-wage-prediction.html#non-linear-models"><i class="fa fa-check"></i><b>9.5</b> Non-linear models</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="machine-learning-for-wage-prediction.html"><a href="machine-learning-for-wage-prediction.html#regression-trees"><i class="fa fa-check"></i><b>9.5.1</b> Regression Trees</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="machine-learning-for-wage-prediction.html"><a href="machine-learning-for-wage-prediction.html#random-forest-and-boosted-trees"><i class="fa fa-check"></i><b>9.6</b> Random Forest and Boosted Trees</a></li>
<li class="chapter" data-level="9.7" data-path="machine-learning-for-wage-prediction.html"><a href="machine-learning-for-wage-prediction.html#results"><i class="fa fa-check"></i><b>9.7</b> Results</a></li>
<li class="chapter" data-level="9.8" data-path="machine-learning-for-wage-prediction.html"><a href="machine-learning-for-wage-prediction.html#ensemble-learning"><i class="fa fa-check"></i><b>9.8</b> Ensemble learning</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="deep-neural-networks-for-wage-prediction.html"><a href="deep-neural-networks-for-wage-prediction.html"><i class="fa fa-check"></i><b>10</b> Deep Neural Networks for Wage Prediction</a>
<ul>
<li class="chapter" data-level="10.1" data-path="deep-neural-networks-for-wage-prediction.html"><a href="deep-neural-networks-for-wage-prediction.html#data-preparation"><i class="fa fa-check"></i><b>10.1</b> Data Preparation</a></li>
<li class="chapter" data-level="10.2" data-path="deep-neural-networks-for-wage-prediction.html"><a href="deep-neural-networks-for-wage-prediction.html#neural-networks"><i class="fa fa-check"></i><b>10.2</b> Neural Networks</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="functional-approximations-by-trees-and-neural-networks.html"><a href="functional-approximations-by-trees-and-neural-networks.html"><i class="fa fa-check"></i><b>11</b> Functional Approximations by Trees and Neural Networks</a>
<ul>
<li class="chapter" data-level="11.1" data-path="functional-approximations-by-trees-and-neural-networks.html"><a href="functional-approximations-by-trees-and-neural-networks.html#functional-approximation-by-a-tree"><i class="fa fa-check"></i><b>11.1</b> Functional Approximation by a Tree</a></li>
<li class="chapter" data-level="11.2" data-path="functional-approximations-by-trees-and-neural-networks.html"><a href="functional-approximations-by-trees-and-neural-networks.html#functional-approximation-by-rf"><i class="fa fa-check"></i><b>11.2</b> Functional Approximation by RF</a></li>
<li class="chapter" data-level="11.3" data-path="functional-approximations-by-trees-and-neural-networks.html"><a href="functional-approximations-by-trees-and-neural-networks.html#boosted-trees"><i class="fa fa-check"></i><b>11.3</b> Boosted Trees</a></li>
<li class="chapter" data-level="11.4" data-path="functional-approximations-by-trees-and-neural-networks.html"><a href="functional-approximations-by-trees-and-neural-networks.html#same-example-with-a-neural-network"><i class="fa fa-check"></i><b>11.4</b> Same Example with a Neural Network</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html"><a href="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html"><i class="fa fa-check"></i><b>12</b> Causal Identification in DAGs using Backdoor and Swigs, Equivalence Classes, Falsifiability Tests</a>
<ul>
<li class="chapter" data-level="12.1" data-path="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html"><a href="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html#graph-generation-and-plotting"><i class="fa fa-check"></i><b>12.1</b> Graph Generation and Plotting</a></li>
<li class="chapter" data-level="12.2" data-path="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html"><a href="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html#report-relatives-of-x2"><i class="fa fa-check"></i><b>12.2</b> Report Relatives of X2</a></li>
<li class="chapter" data-level="12.3" data-path="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html"><a href="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html#find-paths-between-d-and-y"><i class="fa fa-check"></i><b>12.3</b> Find Paths Between D and Y</a></li>
<li class="chapter" data-level="12.4" data-path="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html"><a href="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html#list-all-testable-implications-of-the-model"><i class="fa fa-check"></i><b>12.4</b> List All Testable Implications of the Model</a></li>
<li class="chapter" data-level="12.5" data-path="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html"><a href="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html#identification-by-backdoor-list-minimal-adjustment-sets-to-identify-causal-effecs-d-to-y"><i class="fa fa-check"></i><b>12.5</b> Identification by Backdoor: List minimal adjustment sets to identify causal effecs <span class="math inline">\(D \to Y\)</span></a></li>
<li class="chapter" data-level="12.6" data-path="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html"><a href="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html#identification-via-swig-and-d-separation"><i class="fa fa-check"></i><b>12.6</b> Identification via SWIG and D-separation</a></li>
<li class="chapter" data-level="12.7" data-path="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html"><a href="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html#deduce-conditional-exogeneity-or-ignorability-by-d-separation"><i class="fa fa-check"></i><b>12.7</b> Deduce Conditional Exogeneity or Ignorability by D-separation</a></li>
<li class="chapter" data-level="12.8" data-path="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html"><a href="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html#print-all-average-effects-identifiable-by-conditioning"><i class="fa fa-check"></i><b>12.8</b> Print All Average Effects Identifiable by Conditioning</a></li>
<li class="chapter" data-level="12.9" data-path="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html"><a href="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html#equivalence-classes"><i class="fa fa-check"></i><b>12.9</b> Equivalence Classes</a></li>
<li class="chapter" data-level="12.10" data-path="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html"><a href="causal-identification-in-dags-using-backdoor-and-swigs-equivalence-classes-falsifiability-tests.html#example-of-testing-dag-validity"><i class="fa fa-check"></i><b>12.10</b> Example of Testing DAG Validity</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="dosearch-for-causal-identification-in-dags.html"><a href="dosearch-for-causal-identification-in-dags.html"><i class="fa fa-check"></i><b>13</b> Dosearch for Causal Identification in DAGs</a></li>
<li class="chapter" data-level="14" data-path="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html"><a href="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html"><i class="fa fa-check"></i><b>14</b> A Case Study: The Effect of Gun Ownership on Gun-Homicide Rates</a>
<ul>
<li class="chapter" data-level="14.1" data-path="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html"><a href="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html#data-2"><i class="fa fa-check"></i><b>14.1</b> Data</a></li>
<li class="chapter" data-level="14.2" data-path="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html"><a href="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html#preprocessing."><i class="fa fa-check"></i><b>14.2</b> Preprocessing.</a></li>
<li class="chapter" data-level="14.3" data-path="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html"><a href="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html#the-effect-of-gun-ownership"><i class="fa fa-check"></i><b>14.3</b> The effect of gun ownership</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html"><a href="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html#ols-2"><i class="fa fa-check"></i><b>14.3.1</b> OLS</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html"><a href="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html#dml-algorithm"><i class="fa fa-check"></i><b>14.4</b> DML algorithm</a></li>
<li class="chapter" data-level="14.5" data-path="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html"><a href="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html#lasso-1"><i class="fa fa-check"></i><b>14.5</b> Lasso</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html"><a href="a-case-study-the-effect-of-gun-ownership-on-gun-homicide-rates.html#random-forest"><i class="fa fa-check"></i><b>14.5.1</b> Random Forest</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="the-effect-of-gun-ownership-on-gun-homicide-rates-using-dml-for-neural-nets.html"><a href="the-effect-of-gun-ownership-on-gun-homicide-rates-using-dml-for-neural-nets.html"><i class="fa fa-check"></i><b>15</b> The Effect of Gun Ownership on Gun-Homicide Rates using DML for neural nets</a>
<ul>
<li class="chapter" data-level="15.1" data-path="the-effect-of-gun-ownership-on-gun-homicide-rates-using-dml-for-neural-nets.html"><a href="the-effect-of-gun-ownership-on-gun-homicide-rates-using-dml-for-neural-nets.html#dml-for-neural-nets"><i class="fa fa-check"></i><b>15.1</b> DML for neural nets</a></li>
<li class="chapter" data-level="15.2" data-path="the-effect-of-gun-ownership-on-gun-homicide-rates-using-dml-for-neural-nets.html"><a href="the-effect-of-gun-ownership-on-gun-homicide-rates-using-dml-for-neural-nets.html#estimating-the-effect-with-dlm-for-neural-nets"><i class="fa fa-check"></i><b>15.2</b> Estimating the effect with DLM for neural nets</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html"><i class="fa fa-check"></i><b>16</b> Inference on Predictive and Causal Effects in High-Dimensional Nonlinear Models</a>
<ul>
<li class="chapter" data-level="16.1" data-path="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#impact-of-401k-on-financial-wealth"><i class="fa fa-check"></i><b>16.1</b> Impact of 401(k) on Financial Wealth</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#data-3"><i class="fa fa-check"></i><b>16.1.1</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#double-ml-package"><i class="fa fa-check"></i><b>16.2</b> Double ML package</a></li>
<li class="chapter" data-level="16.3" data-path="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#estimating-the-ate-of-401k-eligibility-on-net-financial-assets"><i class="fa fa-check"></i><b>16.3</b> Estimating the ATE of 401(k) Eligibility on Net Financial Assets</a></li>
<li class="chapter" data-level="16.4" data-path="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#partially-linear-regression-models-plr"><i class="fa fa-check"></i><b>16.4</b> Partially Linear Regression Models (PLR)</a></li>
<li class="chapter" data-level="16.5" data-path="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#interactive-regression-model-irm"><i class="fa fa-check"></i><b>16.5</b> Interactive Regression Model (IRM)</a></li>
<li class="chapter" data-level="16.6" data-path="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#local-average-treatment-effects-of-401k-participation-on-net-financial-assets"><i class="fa fa-check"></i><b>16.6</b> Local Average Treatment Effects of 401(k) Participation on Net Financial Assets</a></li>
<li class="chapter" data-level="16.7" data-path="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#interactive-iv-model-iivm"><i class="fa fa-check"></i><b>16.7</b> Interactive IV Model (IIVM)</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"><a href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"><i class="fa fa-check"></i><b>17</b> Using Dagitty in the Analysis of Impact of 401(k) on Net Financial Wealth</a>
<ul>
<li class="chapter" data-level="17.1" data-path="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"><a href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html#graphs-for-401k-analsyis"><i class="fa fa-check"></i><b>17.1</b> Graphs for 401(K) Analsyis</a></li>
<li class="chapter" data-level="17.2" data-path="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"><a href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html#state-one-graph-where-f-determines-x-and-plot-it"><i class="fa fa-check"></i><b>17.2</b> State one graph (where F determines X) and plot it</a></li>
<li class="chapter" data-level="17.3" data-path="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"><a href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html#list-minimal-adjustment-sets-to-identify-causal-effecs-d-to-y"><i class="fa fa-check"></i><b>17.3</b> List minimal adjustment sets to identify causal effecs <span class="math inline">\(D \to Y\)</span></a></li>
<li class="chapter" data-level="17.4" data-path="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"><a href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html#what-is-the-underlying-principle"><i class="fa fa-check"></i><b>17.4</b> What is the underlying principle?</a></li>
<li class="chapter" data-level="17.5" data-path="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"><a href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html#another-graph-wherere-x-determine-f"><i class="fa fa-check"></i><b>17.5</b> Another Graph (wherere <span class="math inline">\(X\)</span> determine <span class="math inline">\(F\)</span>):</a></li>
<li class="chapter" data-level="17.6" data-path="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"><a href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html#one-more-graph-encompassing-previous-ones-where-f-x-are-jointly-determined-by-latent-factors-a.-we-can-allow-in-fact-the-whole-triple-d-f-x-to-be-jointly-determined-by-latent-factors-a."><i class="fa fa-check"></i><b>17.6</b> One more graph (encompassing previous ones), where (F, X) are jointly determined by latent factors <span class="math inline">\(A\)</span>. We can allow in fact the whole triple (D, F, X) to be jointly determined by latent factors <span class="math inline">\(A\)</span>.</a></li>
<li class="chapter" data-level="17.7" data-path="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"><a href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html#threat-to-idenitification-what-if-f-also-directly-affects-y-note-that-there-are-no-valid-adjustment-sets-in-this-case"><i class="fa fa-check"></i><b>17.7</b> Threat to Idenitification: What if <span class="math inline">\(F\)</span> also directly affects <span class="math inline">\(Y\)</span>? (Note that there are no valid adjustment sets in this case)</a></li>
<li class="chapter" data-level="17.8" data-path="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"><a href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html#introduce-match-amount-m-very-important-mediator-why-mediator.-m-is-not-observed.-luckily-adjusting-for-x-still-works-if-there-is-no-f-to-m-arrow."><i class="fa fa-check"></i><b>17.8</b> Introduce Match Amount <span class="math inline">\(M\)</span> (very important mediator, why mediator?). <span class="math inline">\(M\)</span> is not observed. Luckily adjusting for <span class="math inline">\(X\)</span> still works if there is no <span class="math inline">\(F \to M\)</span> arrow.</a></li>
<li class="chapter" data-level="17.9" data-path="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"><a href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html#if-there-is-f-to-m-arrow-then-adjusting-for-x-is-not-sufficient."><i class="fa fa-check"></i><b>17.9</b> If there is <span class="math inline">\(F \to M\)</span> arrow, then adjusting for <span class="math inline">\(X\)</span> is not sufficient.</a></li>
<li class="chapter" data-level="17.10" data-path="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html"><a href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html#question"><i class="fa fa-check"></i><b>17.10</b> Question:</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="doubledebiased-machine-learning-for-the-partially-linear-regression-model..html"><a href="doubledebiased-machine-learning-for-the-partially-linear-regression-model..html"><i class="fa fa-check"></i><b>18</b> Double/Debiased Machine Learning for the Partially Linear Regression Model.</a>
<ul>
<li class="chapter" data-level="18.1" data-path="doubledebiased-machine-learning-for-the-partially-linear-regression-model..html"><a href="doubledebiased-machine-learning-for-the-partially-linear-regression-model..html#dml-algorithm-1"><i class="fa fa-check"></i><b>18.1</b> DML algorithm</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html"><a href="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html"><i class="fa fa-check"></i><b>19</b> Sensititivy Analysis for Unobserved Confounder with DML and Sensmakr</a>
<ul>
<li class="chapter" data-level="19.1" data-path="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html"><a href="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html#here-we-experiment-with-using-package-sensemakr-in-conjunction-with-debiased-ml"><i class="fa fa-check"></i><b>19.1</b> Here we experiment with using package “sensemakr” in conjunction with debiased ML</a></li>
<li class="chapter" data-level="19.2" data-path="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html"><a href="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html#we-will"><i class="fa fa-check"></i><b>19.2</b> We will</a></li>
<li class="chapter" data-level="19.3" data-path="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html"><a href="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html#take-out-village-fixed-effects-and-run-basic-linear-analysis"><i class="fa fa-check"></i><b>19.3</b> Take out village fixed effects and run basic linear analysis</a></li>
<li class="chapter" data-level="19.4" data-path="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html"><a href="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html#we-first-use-lasso-for-partilling-out-controls"><i class="fa fa-check"></i><b>19.4</b> We first use Lasso for Partilling Out Controls</a></li>
<li class="chapter" data-level="19.5" data-path="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html"><a href="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html#manual-bias-analysis"><i class="fa fa-check"></i><b>19.5</b> Manual Bias Analysis</a></li>
<li class="chapter" data-level="19.6" data-path="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html"><a href="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html#bias-analysis-with-sensemakr"><i class="fa fa-check"></i><b>19.6</b> Bias Analysis with Sensemakr</a></li>
<li class="chapter" data-level="19.7" data-path="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html"><a href="sensititivy-analysis-for-unobserved-confounder-with-dml-and-sensmakr.html#next-we-use-random-forest-as-ml-tool-for-partialling-out"><i class="fa fa-check"></i><b>19.7</b> Next We use Random Forest as ML tool for Partialling Out</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="doubledebiased-ml-for-partially-linear-iv-model.html"><a href="doubledebiased-ml-for-partially-linear-iv-model.html"><i class="fa fa-check"></i><b>20</b> Double/Debiased ML for Partially Linear IV Model</a>
<ul>
<li class="chapter" data-level="20.1" data-path="doubledebiased-ml-for-partially-linear-iv-model.html"><a href="doubledebiased-ml-for-partially-linear-iv-model.html#partially-linear-iv-model"><i class="fa fa-check"></i><b>20.1</b> Partially Linear IV Model</a></li>
<li class="chapter" data-level="20.2" data-path="doubledebiased-ml-for-partially-linear-iv-model.html"><a href="doubledebiased-ml-for-partially-linear-iv-model.html#example"><i class="fa fa-check"></i><b>20.2</b> Example</a></li>
<li class="chapter" data-level="20.3" data-path="doubledebiased-ml-for-partially-linear-iv-model.html"><a href="doubledebiased-ml-for-partially-linear-iv-model.html#plivm-in-residualized-form"><i class="fa fa-check"></i><b>20.3</b> PLIVM in Residualized Form</a></li>
<li class="chapter" data-level="20.4" data-path="doubledebiased-ml-for-partially-linear-iv-model.html"><a href="doubledebiased-ml-for-partially-linear-iv-model.html#dml-for-pliv-model"><i class="fa fa-check"></i><b>20.4</b> DML for PLIV Model</a></li>
<li class="chapter" data-level="20.5" data-path="doubledebiased-ml-for-partially-linear-iv-model.html"><a href="doubledebiased-ml-for-partially-linear-iv-model.html#emprical-example-acemoglu-jonsohn-robinson-aer."><i class="fa fa-check"></i><b>20.5</b> Emprical Example: Acemoglu, Jonsohn, Robinson (AER).</a></li>
<li class="chapter" data-level="20.6" data-path="doubledebiased-ml-for-partially-linear-iv-model.html"><a href="doubledebiased-ml-for-partially-linear-iv-model.html#examine-if-we-have-weak-instruments"><i class="fa fa-check"></i><b>20.6</b> Examine if we have weak instruments</a></li>
<li class="chapter" data-level="20.7" data-path="doubledebiased-ml-for-partially-linear-iv-model.html"><a href="doubledebiased-ml-for-partially-linear-iv-model.html#we-do-have-weak-instruments-because-t-stats-in-regression-tilde-d-sim-tilde-z-are-less-than-4-in-absolute-value"><i class="fa fa-check"></i><b>20.7</b> We do have weak instruments, because t-stats in regression <span class="math inline">\(\tilde D \sim \tilde Z\)</span> are less than 4 in absolute value</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="a-simple-example-of-properties-of-iv-estimator-when-instruments-are-weak.html"><a href="a-simple-example-of-properties-of-iv-estimator-when-instruments-are-weak.html"><i class="fa fa-check"></i><b>21</b> A Simple Example of Properties of IV estimator when Instruments are Weak</a>
<ul>
<li class="chapter" data-level="21.1" data-path="a-simple-example-of-properties-of-iv-estimator-when-instruments-are-weak.html"><a href="a-simple-example-of-properties-of-iv-estimator-when-instruments-are-weak.html#run-1000-trials-to-evaluate-distribution-of-the-iv-estimator"><i class="fa fa-check"></i><b>21.1</b> Run 1000 trials to evaluate distribution of the IV estimator</a></li>
<li class="chapter" data-level="21.2" data-path="a-simple-example-of-properties-of-iv-estimator-when-instruments-are-weak.html"><a href="a-simple-example-of-properties-of-iv-estimator-when-instruments-are-weak.html#plot-the-actual-distribution-against-the-normal-approximation-based-on-strong-instrument-assumption"><i class="fa fa-check"></i><b>21.2</b> Plot the Actual Distribution against the Normal Approximation (based on Strong Instrument Assumption)</a></li>
<li class="chapter" data-level="21.3" data-path="a-simple-example-of-properties-of-iv-estimator-when-instruments-are-weak.html"><a href="a-simple-example-of-properties-of-iv-estimator-when-instruments-are-weak.html#some-help-functions"><i class="fa fa-check"></i><b>21.3</b> Some Help Functions</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="hte-i-binary-treatment.html"><a href="hte-i-binary-treatment.html"><i class="fa fa-check"></i><b>22</b> HTE I: Binary treatment</a>
<ul>
<li class="chapter" data-level="22.1" data-path="hte-i-binary-treatment.html"><a href="hte-i-binary-treatment.html#pre-specified-hypotheses"><i class="fa fa-check"></i><b>22.1</b> Pre-specified hypotheses</a></li>
<li class="chapter" data-level="22.2" data-path="hte-i-binary-treatment.html"><a href="hte-i-binary-treatment.html#data-driven-hypotheses"><i class="fa fa-check"></i><b>22.2</b> Data-driven hypotheses</a>
<ul>
<li class="chapter" data-level="22.2.1" data-path="hte-i-binary-treatment.html"><a href="hte-i-binary-treatment.html#via-causal-trees"><i class="fa fa-check"></i><b>22.2.1</b> Via causal trees</a></li>
<li class="chapter" data-level="22.2.2" data-path="hte-i-binary-treatment.html"><a href="hte-i-binary-treatment.html#via-grf"><i class="fa fa-check"></i><b>22.2.2</b> Via grf</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="hte-i-binary-treatment.html"><a href="hte-i-binary-treatment.html#further-reading"><i class="fa fa-check"></i><b>22.3</b> Further reading</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Machine Learning and Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models" class="section level1" number="16">
<h1><span class="header-section-number">Chapter 16</span> Inference on Predictive and Causal Effects in High-Dimensional Nonlinear Models</h1>
<div id="impact-of-401k-on-financial-wealth" class="section level2" number="16.1">
<h2><span class="header-section-number">16.1</span> Impact of 401(k) on Financial Wealth</h2>
<p>As a practical illustration of the methods developed in this lecture, we consider estimation of the effect of 401(k) eligibility and participation</p>
<p>One can argue that eligibility for enrolling in a 401(k) plan in this data can be taken as exogenous after conditioning on a few observables of which the most important for their argument is income. The basic idea is that, at least around the time 401(k)’s initially became available, people were unlikely to be basing their employment decisions on whether an employer offered a 401(k) but would instead focus on income and other aspects of the job.</p>
<style>
  .col2 {
    columns: 2 200px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 200px; /* chrome, safari */
    -moz-columns: 2 200px;    /* firefox */
  }
  .col3 {
    columns: 3 100px;
    -webkit-columns: 3 100px;
    -moz-columns: 3 100px;
  }
</style>
<div id="data-3" class="section level3" number="16.1.1">
<h3><span class="header-section-number">16.1.1</span> Data</h3>
<p>The data set can be loaded from the <code>hdm</code> package for R and hdmpy for Python by typing</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hdm) </span>
<span id="cb1-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(pension)</span>
<span id="cb1-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb1-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> pension </span>
<span id="cb1-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data)</span></code></pre></div>
<pre><code>## [1] 9915   44</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> doubleml.datasets <span class="im">import</span> fetch_401K</span>
<span id="cb3-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</span>
<span id="cb3-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb3-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hdmpy</span>
<span id="cb3-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyreadr</span>
<span id="cb3-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb3-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb3-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-12" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&quot;ignore&quot;</span>)</span>
<span id="cb3-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-14" aria-hidden="true" tabindex="-1"></a>rdata_read <span class="op">=</span> pyreadr.read_r(<span class="st">&quot;./data/pension.Rdata&quot;</span>)</span>
<span id="cb3-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting the data frame from rdata_read</span></span>
<span id="cb3-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-16" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> rdata_read[ <span class="st">&#39;pension&#39;</span> ]</span>
<span id="cb3-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-17" aria-hidden="true" tabindex="-1"></a>pension <span class="op">=</span> data.copy()</span>
<span id="cb3-18"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb3-18" aria-hidden="true" tabindex="-1"></a>data.shape</span></code></pre></div>
<pre><code>## (9915, 44)</code></pre>
</div>
</div>
<p>See the “Details” section on the description of the data set, which can be accessed by</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(pension)</span></code></pre></div>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb6-1" aria-hidden="true" tabindex="-1"></a>os.system(<span class="st">&quot;start </span><span class="ch">\&quot;\&quot;</span><span class="st"> https://search.r-project.org/CRAN/refmans/hdm/html/pension.html&quot;</span>)</span></code></pre></div>
<pre><code>## 0</code></pre>
</div>
</div>
<p>The data consist of 9,915 observations at the household level drawn from the 1991 Survey of Income and Program Participation (SIPP). All the variables are referred to 1990. We use net financial assets (<em>net_tfa</em>) as the outcome variable, <span class="math inline">\(Y\)</span>, in our analysis. The net financial assets are computed as the sum of IRA balances, 401(k) balances, checking accounts, saving bonds, other interest-earning accounts, other interest-earning assets, stocks, and mutual funds less non mortgage debts.</p>
<p>Among the <span class="math inline">\(9915\)</span> individuals, <span class="math inline">\(3682\)</span> are eligible to participate in the program. The variable <em>e401</em> indicates eligibility and <em>p401</em> indicates participation, respectively.</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb8-1" aria-hidden="true" tabindex="-1"></a>hist_e401 <span class="ot">=</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> e401, <span class="at">fill =</span> <span class="fu">factor</span>(e401))) <span class="sc">+</span> </span>
<span id="cb8-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb8-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_bar</span>()</span>
<span id="cb8-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb8-3" aria-hidden="true" tabindex="-1"></a>hist_e401</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb9-1" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span>
<span id="cb9-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb9-2" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> sns.color_palette()</span>
<span id="cb9-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb9-3" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">&quot;e401&quot;</span>, hue <span class="op">=</span> <span class="st">&quot;e401&quot;</span> , data<span class="op">=</span>data)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
</div>
<p>Eligibility is highly associated with financial wealth:</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb10-1" aria-hidden="true" tabindex="-1"></a>dens_net_tfa <span class="ot">=</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> net_tfa, <span class="at">color =</span> <span class="fu">factor</span>(e401), <span class="at">fill =</span> <span class="fu">factor</span>(e401)) ) <span class="sc">+</span> </span>
<span id="cb10-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb10-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">20000</span>, <span class="dv">150000</span>)) <span class="sc">+</span> </span>
<span id="cb10-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb10-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">facet_wrap</span>(.<span class="sc">~</span>e401) </span>
<span id="cb10-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb10-4" aria-hidden="true" tabindex="-1"></a>dens_net_tfa</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-7-3.png" width="1440" /></p>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> figure</span>
<span id="cb11-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb11-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span></code></pre></div>

<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb12-1" aria-hidden="true" tabindex="-1"></a>sns.displot(data, x<span class="op">=</span><span class="st">&quot;net_tfa&quot;</span>, hue<span class="op">=</span><span class="st">&quot;e401&quot;</span>, col<span class="op">=</span><span class="st">&quot;e401&quot;</span>,</span>
<span id="cb12-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb12-2" aria-hidden="true" tabindex="-1"></a>                kind<span class="op">=</span><span class="st">&quot;kde&quot;</span>, fill<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-8-1.png" width="528" /></p>
</div>
</div>
<p>The unconditional APE of e401 is about <span class="math inline">\(19559\)</span>:</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb13-1" aria-hidden="true" tabindex="-1"></a>e1 <span class="ot">&lt;-</span> data[data<span class="sc">$</span>e401<span class="sc">==</span><span class="dv">1</span>,]</span>
<span id="cb13-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb13-2" aria-hidden="true" tabindex="-1"></a>e0 <span class="ot">&lt;-</span> data[data<span class="sc">$</span>e401<span class="sc">==</span><span class="dv">0</span>,]</span>
<span id="cb13-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(e1<span class="sc">$</span>net_tfa)<span class="sc">-</span><span class="fu">mean</span>(e0<span class="sc">$</span>net_tfa),<span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 19559</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">int</span>(np.<span class="bu">round</span>( data[[<span class="st">&#39;e401&#39;</span>, <span class="st">&#39;net_tfa&#39;</span>]].groupby(<span class="st">&#39;e401&#39;</span>).mean().diff().iloc[<span class="dv">1</span>, <span class="dv">0</span>] ) )</span></code></pre></div>
<pre><code>## 19559</code></pre>
</div>
</div>
<p>Among the <span class="math inline">\(3682\)</span> individuals that are eligible, <span class="math inline">\(2594\)</span> decided to participate in the program. The unconditional APE of p401 is about <span class="math inline">\(27372\)</span>:</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb17-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> data[data<span class="sc">$</span>p401<span class="sc">==</span><span class="dv">1</span>,]</span>
<span id="cb17-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb17-2" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> data[data<span class="sc">$</span>p401<span class="sc">==</span><span class="dv">0</span>,]</span>
<span id="cb17-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(p1<span class="sc">$</span>net_tfa)<span class="sc">-</span><span class="fu">mean</span>(p0<span class="sc">$</span>net_tfa),<span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 27372</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">int</span>(np.<span class="bu">round</span>( data[[<span class="st">&#39;p401&#39;</span>, <span class="st">&#39;net_tfa&#39;</span>]].groupby(<span class="st">&#39;p401&#39;</span>).mean().diff().iloc[<span class="dv">1</span>, <span class="dv">0</span>]))</span></code></pre></div>
<pre><code>## 27372</code></pre>
</div>
</div>
<p>As discussed, these estimates are biased since they do not account for saver heterogeneity and endogeneity of participation.</p>
</div>
</div>
<div id="double-ml-package" class="section level2" number="16.2">
<h2><span class="header-section-number">16.2</span> Double ML package</h2>
<p>We are interested in valid estimators of the average treatment effect of <code>e401</code> and <code>p401</code> on <code>net_tfa</code>. To get those estimators, we use the <code>DoubleML</code> package that internally builds on mlr3. You find additional information on the package on the package website <a href="https://docs.doubleml.org/" class="uri">https://docs.doubleml.org/</a> and the R documentation page <a href="https://docs.doubleml.org/r/stable/" class="uri">https://docs.doubleml.org/r/stable/</a>.</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># installing Double ML</span></span>
<span id="cb21-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#remotes::install_github(&quot;DoubleML/doubleml-for-r&quot;,quiet=TRUE)</span></span>
<span id="cb21-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># loading the packages</span></span>
<span id="cb21-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DoubleML)</span>
<span id="cb21-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb21-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb21-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb21-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span></code></pre></div>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> doubleml <span class="im">as</span> dml</span>
<span id="cb22-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LassoCV, LogisticRegressionCV</span>
<span id="cb22-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier, RandomForestRegressor</span>
<span id="cb22-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier, DecisionTreeRegressor</span>
<span id="cb22-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb22-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb22-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier, XGBRegressor</span></code></pre></div>
</div>
</div>
<p>As mentioned, in the tutorial we use the meta package <code>mlr3</code> to generate predictions with machine learning methods. A comprehensive introduction and description of the <code>mlr3</code> package is provided in the <a href="https://mlr3book.mlr-org.com/">mlr3book</a>. A list of all learners that you can use in <code>mlr3</code> can be found <a href="https://mlr3extralearners.mlr-org.com/articles/learners/list_learners.html">here</a>. The entry in the columns <em>mlr3 Package</em> and <em>Packages</em> indicate which packages must be installed/loaded in your R session.</p>
</div>
<div id="estimating-the-ate-of-401k-eligibility-on-net-financial-assets" class="section level2" number="16.3">
<h2><span class="header-section-number">16.3</span> Estimating the ATE of 401(k) Eligibility on Net Financial Assets</h2>
<p>We first look at the treatment effect of e401 on net total financial assets. We give estimates of the ATE and ATT that corresponds to the linear model</p>
<p><span class="math display">\[\begin{equation*}
Y = D \alpha + f(X)&#39;\beta+ \epsilon,
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(f(X)\)</span> includes indicators of marital status, two-earner status, defined benefit pension status, IRA participation status, and home ownership status, and orthogonal polynomials of degrees 2, 4, 6 and 8 in family size, education, age and income, respectively. The dimensions of <span class="math inline">\(f(X)\)</span> is 25.</p>
<p>In the first step, we report estimates of the average treatment effect (ATE) of 401(k) eligibility on net financial assets both in the partially linear regression (PLR) model and in the interactive regression model (IRM) allowing for heterogeneous treatment effects.</p>
<p>I decided to low down the degree of the income variable from <strong>8</strong> to <strong>6</strong> since sklearn has some problems with values greater than <code>float32</code>. I can not use <code>np.log</code> in <code>inc</code> variable since it has negative values. As a result, we got a column with some <code>None</code> values. For more information about this problem, check this <a href="https://github.com/scikit-learn/scikit-learn/issues/15628">link</a>.</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Constructing the data (as DoubleMLData)</span></span>
<span id="cb23-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-3" aria-hidden="true" tabindex="-1"></a>formula_flex <span class="ot">=</span> <span class="st">&quot;net_tfa ~ e401 + poly(age, 6, raw=TRUE) + poly(inc, 6, raw=TRUE) + poly(educ, 4, raw=TRUE) + poly(fsize, 2, raw=TRUE) + marr + twoearn + db + pira + hown&quot;</span></span>
<span id="cb23-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-5" aria-hidden="true" tabindex="-1"></a>model_flex <span class="ot">=</span> <span class="fu">as.data.table</span>(<span class="fu">model.frame</span>(formula_flex, pension))</span>
<span id="cb23-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-8" aria-hidden="true" tabindex="-1"></a>x_cols <span class="ot">=</span> <span class="fu">colnames</span>(model_flex)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]</span>
<span id="cb23-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-11" aria-hidden="true" tabindex="-1"></a>data_ml_aux <span class="ot">=</span> DoubleMLData<span class="sc">$</span><span class="fu">new</span>(model_flex, </span>
<span id="cb23-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-12" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y_col =</span> <span class="st">&quot;net_tfa&quot;</span>, </span>
<span id="cb23-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-13" aria-hidden="true" tabindex="-1"></a>                               <span class="at">d_cols =</span> <span class="st">&quot;e401&quot;</span>, </span>
<span id="cb23-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">x_cols=</span>x_cols)</span>
<span id="cb23-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-17" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">dim</span>(model_flex)[<span class="dv">2</span>]<span class="sc">-</span><span class="dv">2</span></span>
<span id="cb23-18"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb23-19" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<pre><code>## [1] 23</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># complex model with two-way interactions</span></span>
<span id="cb25-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#data_interactions = fetch_401k(polynomial_features = TRUE, instrument = FALSE)</span></span></code></pre></div>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Constructing the data (as DoubleMLData)</span></span>
<span id="cb26-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> data.copy()[[<span class="st">&#39;marr&#39;</span>, <span class="st">&#39;twoearn&#39;</span>, <span class="st">&#39;db&#39;</span>, <span class="st">&#39;pira&#39;</span>, <span class="st">&#39;hown&#39;</span>]]</span>
<span id="cb26-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-4" aria-hidden="true" tabindex="-1"></a>poly_dict <span class="op">=</span> {<span class="st">&#39;age&#39;</span>: <span class="dv">6</span>,</span>
<span id="cb26-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;inc&#39;</span>: <span class="dv">6</span>,</span>
<span id="cb26-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;educ&#39;</span>: <span class="dv">4</span>,</span>
<span id="cb26-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;fsize&#39;</span>: <span class="dv">2</span>}</span>
<span id="cb26-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, degree <span class="kw">in</span> poly_dict.items():</span>
<span id="cb26-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-9" aria-hidden="true" tabindex="-1"></a>    poly <span class="op">=</span> PolynomialFeatures(degree, include_bias<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-10" aria-hidden="true" tabindex="-1"></a>    data_transf <span class="op">=</span> poly.fit_transform(data[[key]])</span>
<span id="cb26-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-11" aria-hidden="true" tabindex="-1"></a>    x_cols <span class="op">=</span> poly.get_feature_names([key])</span>
<span id="cb26-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-12" aria-hidden="true" tabindex="-1"></a>    data_transf <span class="op">=</span> pd.DataFrame(data_transf, columns<span class="op">=</span>x_cols)</span>
<span id="cb26-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-14" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> pd.concat((features, data_transf),</span>
<span id="cb26-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-15" aria-hidden="true" tabindex="-1"></a>                          axis<span class="op">=</span><span class="dv">1</span>, sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-17" aria-hidden="true" tabindex="-1"></a>model_flex <span class="op">=</span> pd.concat((data.copy()[[<span class="st">&#39;net_tfa&#39;</span>, <span class="st">&#39;e401&#39;</span>]], features.copy()),</span>
<span id="cb26-18"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-18" aria-hidden="true" tabindex="-1"></a>                        axis<span class="op">=</span><span class="dv">1</span>, sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-19"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-20" aria-hidden="true" tabindex="-1"></a>x_cols <span class="op">=</span> model_flex.columns.to_list()[<span class="dv">2</span>:]</span>
<span id="cb26-21"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize DoubleMLData (data-backend of DoubleML)</span></span>
<span id="cb26-23"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-23" aria-hidden="true" tabindex="-1"></a>data_ml_aux <span class="op">=</span> dml.DoubleMLData(model_flex, y_col<span class="op">=</span><span class="st">&#39;net_tfa&#39;</span>, <span class="op">\</span></span>
<span id="cb26-24"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-24" aria-hidden="true" tabindex="-1"></a>                           d_cols <span class="op">=</span><span class="st">&#39;e401&#39;</span> , x_cols <span class="op">=</span> x_cols)</span>
<span id="cb26-25"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co"># complex model with two-way interactions</span></span>
<span id="cb26-27"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="co"># data_interactions</span></span>
<span id="cb26-28"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co"># fetch_401K( return_type  = &#39;DataFrame&#39; , polynomial_features = True )</span></span>
<span id="cb26-29"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-30"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-30" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> model_flex.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">2</span></span>
<span id="cb26-31"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p)</span></code></pre></div>
<pre><code>## 23</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb28-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> model_flex.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">2</span></span>
<span id="cb28-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p)</span></code></pre></div>
<pre><code>## 23</code></pre>
</div>
</div>
</div>
<div id="partially-linear-regression-models-plr" class="section level2" number="16.4">
<h2><span class="header-section-number">16.4</span> Partially Linear Regression Models (PLR)</h2>
<p>We start using lasso to estimate the function <span class="math inline">\(g_0\)</span> and <span class="math inline">\(m_0\)</span> in the following PLR model:</p>
<p><span class="math display">\[\begin{eqnarray}
 &amp;  Y = D\theta_0 + g_0(X) + \zeta,  &amp;  E[\zeta \mid D,X]= 0,\\
 &amp; D = m_0(X) +  V,   &amp;  E[V \mid X] = 0.
\end{eqnarray}\]</span></p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimating the PLR</span></span>
<span id="cb30-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb30-2" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">&quot;mlr3&quot;</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">&quot;warn&quot;</span>) </span>
<span id="cb30-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb30-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb30-4" aria-hidden="true" tabindex="-1"></a>lasso <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.cv_glmnet&quot;</span>,<span class="at">nfolds =</span> <span class="dv">5</span>, <span class="at">s =</span> <span class="st">&quot;lambda.min&quot;</span>)</span>
<span id="cb30-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb30-5" aria-hidden="true" tabindex="-1"></a>lasso_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">&quot;classif.cv_glmnet&quot;</span>, <span class="at">nfolds =</span> <span class="dv">5</span>, <span class="at">s =</span> <span class="st">&quot;lambda.min&quot;</span>)</span>
<span id="cb30-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb30-7" aria-hidden="true" tabindex="-1"></a>dml_plr <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(data_ml_aux, <span class="at">ml_g =</span> lasso, <span class="at">ml_m =</span> lasso_class, <span class="at">n_folds=</span><span class="dv">3</span>)</span>
<span id="cb30-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb30-8" aria-hidden="true" tabindex="-1"></a>dml_plr<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb30-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb30-9" aria-hidden="true" tabindex="-1"></a>dml_plr<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## e401      8952       1269   7.057  1.7e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb32-1" aria-hidden="true" tabindex="-1"></a>lasso_plr <span class="ot">&lt;-</span> dml_plr<span class="sc">$</span>coef</span>
<span id="cb32-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb32-2" aria-hidden="true" tabindex="-1"></a>lasso_std_plr <span class="ot">&lt;-</span> dml_plr<span class="sc">$</span>se</span></code></pre></div>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimating the PLR</span></span>
<span id="cb33-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize learners</span></span>
<span id="cb33-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-3" aria-hidden="true" tabindex="-1"></a>Cs <span class="op">=</span> <span class="fl">0.0001</span><span class="op">*</span>np.logspace(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">10</span>)</span>
<span id="cb33-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-4" aria-hidden="true" tabindex="-1"></a>lasso <span class="op">=</span> make_pipeline(StandardScaler(), LassoCV(cv<span class="op">=</span><span class="dv">5</span>, max_iter<span class="op">=</span><span class="dv">10000</span>))</span>
<span id="cb33-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-5" aria-hidden="true" tabindex="-1"></a>lasso_class <span class="op">=</span> make_pipeline(StandardScaler(),</span>
<span id="cb33-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-6" aria-hidden="true" tabindex="-1"></a>                            LogisticRegressionCV(cv<span class="op">=</span><span class="dv">5</span>, penalty<span class="op">=</span><span class="st">&#39;l1&#39;</span>, solver<span class="op">=</span><span class="st">&#39;liblinear&#39;</span>,</span>
<span id="cb33-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-7" aria-hidden="true" tabindex="-1"></a>                                                 Cs <span class="op">=</span> Cs, max_iter<span class="op">=</span><span class="dv">1000</span>))</span>
<span id="cb33-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-9" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb33-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize DoubleMLPLR model</span></span>
<span id="cb33-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-11" aria-hidden="true" tabindex="-1"></a>dml_plr <span class="op">=</span> dml.DoubleMLPLR(data_ml_aux,</span>
<span id="cb33-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-12" aria-hidden="true" tabindex="-1"></a>                                ml_g <span class="op">=</span> lasso,</span>
<span id="cb33-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-13" aria-hidden="true" tabindex="-1"></a>                                ml_m <span class="op">=</span> lasso_class,</span>
<span id="cb33-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-14" aria-hidden="true" tabindex="-1"></a>                                n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb33-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb33-16" aria-hidden="true" tabindex="-1"></a>dml_plr.fit(store_predictions<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_plr.DoubleMLPLR object at 0x00000000245CEAF0&gt;</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb35-1" aria-hidden="true" tabindex="-1"></a>lasso_plr <span class="op">=</span> dml_plr.summary.coef[<span class="dv">0</span>]</span>
<span id="cb35-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb35-2" aria-hidden="true" tabindex="-1"></a>lasso_std_plr <span class="op">=</span> dml_plr.summary[<span class="st">&#39;std err&#39;</span>][<span class="dv">0</span>]</span>
<span id="cb35-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb35-3" aria-hidden="true" tabindex="-1"></a>dml_plr.summary</span></code></pre></div>
<pre><code>##              coef      std err  ...        2.5 %        97.5 %
## e401  8919.577401  1325.857662  ...  6320.944135  11518.210667
## 
## [1 rows x 6 columns]</code></pre>
</div>
</div>
<p>Let us check the predictive performance of this model.</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb37-1" aria-hidden="true" tabindex="-1"></a>dml_plr<span class="sc">$</span><span class="fu">params_names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;ml_g&quot; &quot;ml_m&quot;</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb39-1" aria-hidden="true" tabindex="-1"></a>g_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_plr<span class="sc">$</span>predictions<span class="sc">$</span>ml_g) <span class="co"># predictions of g_o</span></span>
<span id="cb39-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb39-2" aria-hidden="true" tabindex="-1"></a>m_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_plr<span class="sc">$</span>predictions<span class="sc">$</span>ml_m) <span class="co"># predictions of m_o</span></span></code></pre></div>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb40-1" aria-hidden="true" tabindex="-1"></a>g_hat <span class="op">=</span> dml_plr.predictions[<span class="st">&#39;ml_g&#39;</span>].flatten() <span class="co"># predictions of g_o</span></span>
<span id="cb40-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb40-2" aria-hidden="true" tabindex="-1"></a>m_hat <span class="op">=</span> dml_plr.predictions[<span class="st">&#39;ml_m&#39;</span>].flatten() <span class="co"># predictions of m_o</span></span>
<span id="cb40-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dml_plr.params_names)</span></code></pre></div>
<pre><code>## [&#39;ml_g&#39;, &#39;ml_m&#39;]</code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb42-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb42-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>net_tfa) <span class="co"># true observations</span></span>
<span id="cb42-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb42-3" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dml_plr<span class="sc">$</span>coef) <span class="co"># estimated regression coefficient</span></span>
<span id="cb42-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb42-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>e401) </span>
<span id="cb42-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb42-5" aria-hidden="true" tabindex="-1"></a>predictions_y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(d<span class="sc">*</span>theta)<span class="sc">+</span>g_hat <span class="co"># predictions for y</span></span>
<span id="cb42-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb42-6" aria-hidden="true" tabindex="-1"></a>lasso_y_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>predictions_y)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb42-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb42-7" aria-hidden="true" tabindex="-1"></a>lasso_y_rmse</span></code></pre></div>
<pre><code>## [1] 53735.74</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb44-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb44-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pension.net_tfa.to_numpy() <span class="co"># true observations</span></span>
<span id="cb44-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb44-3" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> dml_plr.coef[ <span class="dv">0</span> ] <span class="co"># estimated regression coefficient</span></span>
<span id="cb44-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb44-4" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pension.e401.to_numpy()</span>
<span id="cb44-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb44-5" aria-hidden="true" tabindex="-1"></a>predictions_y <span class="op">=</span> d<span class="op">*</span>theta <span class="op">+</span> g_hat  <span class="co"># predictions for y</span></span>
<span id="cb44-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb44-6" aria-hidden="true" tabindex="-1"></a>lasso_y_rmse <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> predictions_y ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb44-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb44-7" aria-hidden="true" tabindex="-1"></a>lasso_y_rmse</span></code></pre></div>
<pre><code>## 54342.024308477914</code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb46-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb46-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>e401) </span>
<span id="cb46-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb46-3" aria-hidden="true" tabindex="-1"></a>lasso_d_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb46-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb46-4" aria-hidden="true" tabindex="-1"></a>lasso_d_rmse</span></code></pre></div>
<pre><code>## [1] 0.4443213</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span>
<span id="cb48-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">ifelse</span>(m_hat <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">!=</span> d)</span></code></pre></div>
<pre><code>## [1] 0.3167927</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb50-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb50-2" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pension.e401.to_numpy()</span>
<span id="cb50-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb50-3" aria-hidden="true" tabindex="-1"></a>lasso_d_rmse <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb50-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( lasso_d_rmse )</span>
<span id="cb50-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span></code></pre></div>
<pre><code>## 0.4585164421000309</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean( ( m_hat <span class="op">&gt;</span> <span class="fl">0.5</span> ) <span class="op">*</span> <span class="dv">1</span> <span class="op">!=</span> d ))</span></code></pre></div>
<pre><code>## 0.31376701966717097</code></pre>
</div>
</div>
<p>Then, we repeat this procedure for various machine learning methods.</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="cb54-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-3" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">&quot;mlr3&quot;</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">&quot;warn&quot;</span>) </span>
<span id="cb54-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-6" aria-hidden="true" tabindex="-1"></a>randomForest <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.ranger&quot;</span>)</span>
<span id="cb54-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-9" aria-hidden="true" tabindex="-1"></a>randomForest_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">&quot;classif.ranger&quot;</span>)</span>
<span id="cb54-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-12" aria-hidden="true" tabindex="-1"></a>dml_plr <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(data_ml_aux, </span>
<span id="cb54-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ml_g =</span> randomForest, </span>
<span id="cb54-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ml_m =</span> randomForest_class, </span>
<span id="cb54-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">n_folds=</span><span class="dv">3</span>)</span>
<span id="cb54-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-18" aria-hidden="true" tabindex="-1"></a>dml_plr<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>) <span class="co"># set store_predictions=TRUE to evaluate the model</span></span>
<span id="cb54-19"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-19" aria-hidden="true" tabindex="-1"></a>forest_plr <span class="ot">&lt;-</span> dml_plr<span class="sc">$</span>coef</span>
<span id="cb54-20"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-20" aria-hidden="true" tabindex="-1"></a>forest_std_plr <span class="ot">&lt;-</span> dml_plr<span class="sc">$</span>se</span>
<span id="cb54-21"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb54-21" aria-hidden="true" tabindex="-1"></a>dml_plr<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## e401      8359       1267   6.599 4.14e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb56"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="cb56-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb56-2" aria-hidden="true" tabindex="-1"></a>randomForest <span class="op">=</span> RandomForestRegressor(</span>
<span id="cb56-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb56-3" aria-hidden="true" tabindex="-1"></a>    n_estimators <span class="op">=</span> <span class="dv">500</span>  )</span>
<span id="cb56-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb56-5" aria-hidden="true" tabindex="-1"></a>randomForest_class <span class="op">=</span> RandomForestClassifier(</span>
<span id="cb56-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb56-6" aria-hidden="true" tabindex="-1"></a>    n_estimators <span class="op">=</span> <span class="dv">500</span> )</span>
<span id="cb56-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb56-9" aria-hidden="true" tabindex="-1"></a>dml_plr <span class="op">=</span> dml.DoubleMLPLR(data_ml_aux, ml_g <span class="op">=</span> randomForest, <span class="op">\</span></span>
<span id="cb56-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb56-10" aria-hidden="true" tabindex="-1"></a>                         ml_m <span class="op">=</span> randomForest_class, n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb56-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb56-11" aria-hidden="true" tabindex="-1"></a>dml_plr.fit(store_predictions<span class="op">=</span><span class="va">True</span>) <span class="co"># set store_predictions=TRUE to evaluate the model</span></span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_plr.DoubleMLPLR object at 0x0000000064929BE0&gt;</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb58-1" aria-hidden="true" tabindex="-1"></a>forest_plr <span class="op">=</span> dml_plr.coef</span>
<span id="cb58-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb58-2" aria-hidden="true" tabindex="-1"></a>forest_std_plr <span class="op">=</span> dml_plr.summary[ <span class="st">&#39;std err&#39;</span> ]</span>
<span id="cb58-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb58-4" aria-hidden="true" tabindex="-1"></a>dml_plr.summary</span></code></pre></div>
<pre><code>##              coef      std err  ...        2.5 %        97.5 %
## e401  8702.588054  1310.423641  ...  6134.204913  11270.971196
## 
## [1 rows x 6 columns]</code></pre>
</div>
</div>
<p>We can compare the accuracy of this model to the model that has been estimated with lasso.</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation predictions</span></span>
<span id="cb60-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-2" aria-hidden="true" tabindex="-1"></a>g_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_plr<span class="sc">$</span>predictions<span class="sc">$</span>ml_g) <span class="co"># predictions of g_o</span></span>
<span id="cb60-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-3" aria-hidden="true" tabindex="-1"></a>m_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_plr<span class="sc">$</span>predictions<span class="sc">$</span>ml_m) <span class="co"># predictions of m_o</span></span>
<span id="cb60-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-4" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dml_plr<span class="sc">$</span>coef) <span class="co"># estimated regression coefficient</span></span>
<span id="cb60-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-5" aria-hidden="true" tabindex="-1"></a>predictions_y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(d<span class="sc">*</span>theta)<span class="sc">+</span>g_hat <span class="co"># predictions for y</span></span>
<span id="cb60-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-6" aria-hidden="true" tabindex="-1"></a>forest_y_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>predictions_y)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb60-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb60-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-10" aria-hidden="true" tabindex="-1"></a>forest_d_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb60-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="do">#### Results</span></span>
<span id="cb60-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb60-14" aria-hidden="true" tabindex="-1"></a>forest_y_rmse</span></code></pre></div>
<pre><code>## [1] 56078.76</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb62-1" aria-hidden="true" tabindex="-1"></a>forest_d_rmse</span></code></pre></div>
<pre><code>## [1] 0.4558187</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span>
<span id="cb64-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">ifelse</span>(m_hat <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">!=</span> d)</span></code></pre></div>
<pre><code>## [1] 0.3324256</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation predictions</span></span>
<span id="cb66-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-2" aria-hidden="true" tabindex="-1"></a>g_hat <span class="op">=</span> dml_plr.predictions[<span class="st">&#39;ml_g&#39;</span>].flatten() <span class="co"># predictions of g_o</span></span>
<span id="cb66-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-3" aria-hidden="true" tabindex="-1"></a>m_hat <span class="op">=</span> dml_plr.predictions[<span class="st">&#39;ml_m&#39;</span>].flatten() <span class="co"># predictions of m_o</span></span>
<span id="cb66-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pension.net_tfa.to_numpy()</span>
<span id="cb66-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-5" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> dml_plr.coef[ <span class="dv">0</span> ] <span class="co"># estimated regression coefficient</span></span>
<span id="cb66-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-6" aria-hidden="true" tabindex="-1"></a>predictions_y <span class="op">=</span> d<span class="op">*</span>theta <span class="op">+</span> g_hat <span class="co"># predictions for y</span></span>
<span id="cb66-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-7" aria-hidden="true" tabindex="-1"></a>forest_y_rmse <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> predictions_y ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb66-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb66-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-10" aria-hidden="true" tabindex="-1"></a>forest_d_rmse <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb66-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co">#### Results</span></span>
<span id="cb66-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( forest_y_rmse )</span></code></pre></div>
<pre><code>## 58456.527347918534</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( forest_d_rmse )</span>
<span id="cb68-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span></code></pre></div>
<pre><code>## 0.4659644938522823</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb70-1" aria-hidden="true" tabindex="-1"></a>np.mean( ( m_hat <span class="op">&gt;</span> <span class="fl">0.5</span> ) <span class="op">*</span> <span class="dv">1</span> <span class="op">!=</span> d )</span></code></pre></div>
<pre><code>## 0.3495713565305093</code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trees</span></span>
<span id="cb72-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb72-2" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">&quot;mlr3&quot;</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">&quot;warn&quot;</span>) </span>
<span id="cb72-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb72-4" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.rpart&quot;</span>)</span>
<span id="cb72-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb72-5" aria-hidden="true" tabindex="-1"></a>trees_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">&quot;classif.rpart&quot;</span>)</span>
<span id="cb72-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb72-7" aria-hidden="true" tabindex="-1"></a>dml_plr <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(data_ml_aux, <span class="at">ml_g =</span> trees, <span class="at">ml_m =</span> trees_class, <span class="at">n_folds=</span><span class="dv">3</span>)</span>
<span id="cb72-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb72-8" aria-hidden="true" tabindex="-1"></a>dml_plr<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb72-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb72-9" aria-hidden="true" tabindex="-1"></a>dml_plr<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## e401      8835       1317   6.708 1.98e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb74-1" aria-hidden="true" tabindex="-1"></a>tree_plr <span class="ot">&lt;-</span> dml_plr<span class="sc">$</span>coef</span>
<span id="cb74-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb74-2" aria-hidden="true" tabindex="-1"></a>tree_std_plr <span class="ot">&lt;-</span> dml_plr<span class="sc">$</span>se</span>
<span id="cb74-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation predictions</span></span>
<span id="cb74-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb74-5" aria-hidden="true" tabindex="-1"></a>g_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_plr<span class="sc">$</span>predictions<span class="sc">$</span>ml_g) <span class="co"># predictions of g_o</span></span>
<span id="cb74-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb74-6" aria-hidden="true" tabindex="-1"></a>m_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_plr<span class="sc">$</span>predictions<span class="sc">$</span>ml_m) <span class="co"># predictions of m_o</span></span>
<span id="cb74-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb74-7" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dml_plr<span class="sc">$</span>coef) <span class="co"># estimated regression coefficient</span></span>
<span id="cb74-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb74-8" aria-hidden="true" tabindex="-1"></a>predictions_y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(d<span class="sc">*</span>theta)<span class="sc">+</span>g_hat <span class="co"># predictions for y</span></span>
<span id="cb74-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb74-9" aria-hidden="true" tabindex="-1"></a>tree_y_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>predictions_y)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb74-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb74-10" aria-hidden="true" tabindex="-1"></a>tree_y_rmse</span></code></pre></div>
<pre><code>## [1] 56708.52</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb76-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb76-2" aria-hidden="true" tabindex="-1"></a>tree_d_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb76-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb76-3" aria-hidden="true" tabindex="-1"></a>tree_d_rmse</span></code></pre></div>
<pre><code>## [1] 0.4553888</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span>
<span id="cb78-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">ifelse</span>(m_hat <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">!=</span> d)</span></code></pre></div>
<pre><code>## [1] 0.3136662</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trees</span></span>
<span id="cb80-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-2" aria-hidden="true" tabindex="-1"></a>trees <span class="op">=</span> DecisionTreeRegressor(</span>
<span id="cb80-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-3" aria-hidden="true" tabindex="-1"></a>        max_depth<span class="op">=</span><span class="dv">30</span>, ccp_alpha<span class="op">=</span><span class="fl">0.01</span>, min_samples_split<span class="op">=</span><span class="dv">20</span>, <span class="op">\</span></span>
<span id="cb80-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-4" aria-hidden="true" tabindex="-1"></a>        min_samples_leaf<span class="op">=</span> np.<span class="bu">round</span>(<span class="dv">20</span><span class="op">/</span><span class="dv">3</span>).astype(<span class="bu">int</span>))</span>
<span id="cb80-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-6" aria-hidden="true" tabindex="-1"></a>trees_class <span class="op">=</span> DecisionTreeClassifier( max_depth<span class="op">=</span><span class="dv">30</span>, ccp_alpha<span class="op">=</span><span class="fl">0.01</span>, <span class="op">\</span></span>
<span id="cb80-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-7" aria-hidden="true" tabindex="-1"></a>                min_samples_split<span class="op">=</span><span class="dv">20</span>, <span class="op">\</span></span>
<span id="cb80-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-8" aria-hidden="true" tabindex="-1"></a>                min_samples_leaf<span class="op">=</span> np.<span class="bu">round</span>(<span class="dv">20</span><span class="op">/</span><span class="dv">3</span>).astype(<span class="bu">int</span>) )</span>
<span id="cb80-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-10" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb80-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-11" aria-hidden="true" tabindex="-1"></a>dml_plr <span class="op">=</span> dml.DoubleMLPLR(data_ml_aux,</span>
<span id="cb80-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-12" aria-hidden="true" tabindex="-1"></a>                               ml_g <span class="op">=</span> trees,</span>
<span id="cb80-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-13" aria-hidden="true" tabindex="-1"></a>                               ml_m <span class="op">=</span> trees_class,</span>
<span id="cb80-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-14" aria-hidden="true" tabindex="-1"></a>                               n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb80-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb80-15" aria-hidden="true" tabindex="-1"></a>dml_plr.fit(store_predictions<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_plr.DoubleMLPLR object at 0x00000000C4DD61F0&gt;</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb82-1" aria-hidden="true" tabindex="-1"></a>tree_summary <span class="op">=</span> dml_plr.summary</span>
<span id="cb82-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tree_summary)</span></code></pre></div>
<pre><code>##              coef      std err  ...        2.5 %        97.5 %
## e401  8594.661891  1383.808638  ...  5882.446799  11306.876983
## 
## [1 rows x 6 columns]</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb84-1" aria-hidden="true" tabindex="-1"></a>dml_plr.fit(store_predictions<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_plr.DoubleMLPLR object at 0x00000000C4DD61F0&gt;</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb86-1" aria-hidden="true" tabindex="-1"></a>dml_plr.summary</span></code></pre></div>
<pre><code>##              coef      std err  ...        2.5 %        97.5 %
## e401  8601.584926  1383.825475  ...  5889.336834  11313.833019
## 
## [1 rows x 6 columns]</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-1" aria-hidden="true" tabindex="-1"></a>tree_plr <span class="op">=</span> dml_plr.coef</span>
<span id="cb88-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-2" aria-hidden="true" tabindex="-1"></a>tree_std_plr <span class="op">=</span> dml_plr.summary[ <span class="st">&#39;std err&#39;</span> ]</span>
<span id="cb88-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation predictions</span></span>
<span id="cb88-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-5" aria-hidden="true" tabindex="-1"></a>g_hat <span class="op">=</span> dml_plr.predictions[<span class="st">&#39;ml_g&#39;</span>].flatten() <span class="co"># predictions of g_o</span></span>
<span id="cb88-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-6" aria-hidden="true" tabindex="-1"></a>m_hat <span class="op">=</span> dml_plr.predictions[<span class="st">&#39;ml_m&#39;</span>].flatten() <span class="co"># predictions of m_o</span></span>
<span id="cb88-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pension.net_tfa.to_numpy()</span>
<span id="cb88-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-9" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> dml_plr.coef[ <span class="dv">0</span> ] <span class="co"># estimated regression coefficient</span></span>
<span id="cb88-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-10" aria-hidden="true" tabindex="-1"></a>predictions_y <span class="op">=</span> d<span class="op">*</span>theta <span class="op">+</span> g_hat <span class="co"># predictions for y</span></span>
<span id="cb88-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-11" aria-hidden="true" tabindex="-1"></a>tree_y_rmse <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> predictions_y ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb88-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( tree_y_rmse )</span>
<span id="cb88-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span></code></pre></div>
<pre><code>## 58017.721042321384</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb90-1" aria-hidden="true" tabindex="-1"></a>tree_d_rmse <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb90-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( tree_d_rmse )</span>
<span id="cb90-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span></code></pre></div>
<pre><code>## 0.4546690531536573</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb92-1" aria-hidden="true" tabindex="-1"></a>np.mean( ( m_hat <span class="op">&gt;</span> <span class="fl">0.5</span> ) <span class="op">*</span> <span class="dv">1</span> <span class="op">!=</span> d )</span></code></pre></div>
<pre><code>## 0.35269793242561776</code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boosting</span></span>
<span id="cb94-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb94-2" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">&quot;mlr3&quot;</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">&quot;warn&quot;</span>) </span>
<span id="cb94-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb94-3" aria-hidden="true" tabindex="-1"></a>boost<span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.xgboost&quot;</span>,<span class="at">objective=</span><span class="st">&quot;reg:squarederror&quot;</span>)</span>
<span id="cb94-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb94-4" aria-hidden="true" tabindex="-1"></a>boost_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">&quot;classif.xgboost&quot;</span>,<span class="at">objective =</span> <span class="st">&quot;binary:logistic&quot;</span>,<span class="at">eval_metric =</span><span class="st">&quot;logloss&quot;</span>)</span>
<span id="cb94-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb94-6" aria-hidden="true" tabindex="-1"></a>dml_plr <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(data_ml_aux, <span class="at">ml_g =</span> boost, <span class="at">ml_m =</span> boost_class, <span class="at">n_folds=</span><span class="dv">3</span>)</span>
<span id="cb94-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb94-7" aria-hidden="true" tabindex="-1"></a>dml_plr<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb94-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb94-8" aria-hidden="true" tabindex="-1"></a>dml_plr<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## e401      8867       1342   6.606 3.95e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb96-1" aria-hidden="true" tabindex="-1"></a>boost_plr <span class="ot">&lt;-</span> dml_plr<span class="sc">$</span>coef</span>
<span id="cb96-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb96-2" aria-hidden="true" tabindex="-1"></a>boost_std_plr <span class="ot">&lt;-</span> dml_plr<span class="sc">$</span>se</span>
<span id="cb96-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation predictions</span></span>
<span id="cb96-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb96-5" aria-hidden="true" tabindex="-1"></a>g_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_plr<span class="sc">$</span>predictions<span class="sc">$</span>ml_g) <span class="co"># predictions of g_o</span></span>
<span id="cb96-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb96-6" aria-hidden="true" tabindex="-1"></a>m_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_plr<span class="sc">$</span>predictions<span class="sc">$</span>ml_m) <span class="co"># predictions of m_o</span></span>
<span id="cb96-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb96-7" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dml_plr<span class="sc">$</span>coef) <span class="co"># estimated regression coefficient</span></span>
<span id="cb96-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb96-8" aria-hidden="true" tabindex="-1"></a>predictions_y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(d<span class="sc">*</span>theta)<span class="sc">+</span>g_hat <span class="co"># predictions for y</span></span>
<span id="cb96-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb96-9" aria-hidden="true" tabindex="-1"></a>boost_y_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>predictions_y)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb96-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb96-10" aria-hidden="true" tabindex="-1"></a>boost_y_rmse</span></code></pre></div>
<pre><code>## [1] 59816.19</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb98-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb98-2" aria-hidden="true" tabindex="-1"></a>boost_d_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb98-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb98-3" aria-hidden="true" tabindex="-1"></a>boost_d_rmse</span></code></pre></div>
<pre><code>## [1] 0.4726804</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span>
<span id="cb100-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">ifelse</span>(m_hat <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">!=</span> d)</span></code></pre></div>
<pre><code>## [1] 0.3237519</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb102"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boosted Trees</span></span>
<span id="cb102-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb102-2" aria-hidden="true" tabindex="-1"></a>boost <span class="op">=</span> XGBRegressor(n_jobs<span class="op">=</span><span class="dv">1</span>, objective <span class="op">=</span> <span class="st">&quot;reg:squarederror&quot;</span> )</span>
<span id="cb102-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb102-3" aria-hidden="true" tabindex="-1"></a>boost_class <span class="op">=</span> XGBClassifier(use_label_encoder<span class="op">=</span><span class="va">False</span>, n_jobs<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb102-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb102-4" aria-hidden="true" tabindex="-1"></a>                            objective <span class="op">=</span> <span class="st">&quot;binary:logistic&quot;</span>, <span class="op">\</span></span>
<span id="cb102-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb102-5" aria-hidden="true" tabindex="-1"></a>                            eval_metric <span class="op">=</span> <span class="st">&quot;logloss&quot;</span> )</span>
<span id="cb102-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb102-7" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb102-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb102-8" aria-hidden="true" tabindex="-1"></a>dml_plr <span class="op">=</span> dml.DoubleMLPLR( data_ml_aux ,</span>
<span id="cb102-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb102-9" aria-hidden="true" tabindex="-1"></a>                                ml_g <span class="op">=</span> boost,</span>
<span id="cb102-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb102-10" aria-hidden="true" tabindex="-1"></a>                                ml_m <span class="op">=</span> boost_class,</span>
<span id="cb102-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb102-11" aria-hidden="true" tabindex="-1"></a>                                n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb102-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb102-12" aria-hidden="true" tabindex="-1"></a>dml_plr.fit(store_predictions<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_plr.DoubleMLPLR object at 0x00000000C4DC2160&gt;</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb104-1" aria-hidden="true" tabindex="-1"></a>boost_summary <span class="op">=</span> dml_plr.summary</span>
<span id="cb104-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( boost_summary )</span></code></pre></div>
<pre><code>##              coef      std err  ...        2.5 %        97.5 %
## e401  9129.263678  1471.781415  ...  6244.625111  12013.902244
## 
## [1 rows x 6 columns]</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb106-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-1" aria-hidden="true" tabindex="-1"></a>boost_plr <span class="op">=</span> dml_plr.coef</span>
<span id="cb106-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-2" aria-hidden="true" tabindex="-1"></a>boost_std_plr <span class="op">=</span> dml_plr.summary[ <span class="st">&#39;std err&#39;</span> ]</span>
<span id="cb106-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation predictions</span></span>
<span id="cb106-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-5" aria-hidden="true" tabindex="-1"></a>g_hat <span class="op">=</span> dml_plr.predictions[<span class="st">&#39;ml_g&#39;</span>].flatten() <span class="co"># predictions of g_o</span></span>
<span id="cb106-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-6" aria-hidden="true" tabindex="-1"></a>m_hat <span class="op">=</span> dml_plr.predictions[<span class="st">&#39;ml_m&#39;</span>].flatten() <span class="co"># predictions of m_o</span></span>
<span id="cb106-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pension.net_tfa.to_numpy()</span>
<span id="cb106-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-8" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> dml_plr.coef[ <span class="dv">0</span> ]  <span class="co"># estimated regression coefficient</span></span>
<span id="cb106-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-9" aria-hidden="true" tabindex="-1"></a>predictions_y <span class="op">=</span> d<span class="op">*</span>theta <span class="op">+</span> g_hat <span class="co"># predictions for y</span></span>
<span id="cb106-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-11" aria-hidden="true" tabindex="-1"></a>boost_y_rmse <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> predictions_y ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb106-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( boost_y_rmse )</span>
<span id="cb106-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb106-14" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span></code></pre></div>
<pre><code>## 62126.68237198471</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb108-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb108-1" aria-hidden="true" tabindex="-1"></a>boost_d_rmse <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb108-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( boost_d_rmse )</span>
<span id="cb108-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span></code></pre></div>
<pre><code>## 0.4629817464588606</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb110-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb110-1" aria-hidden="true" tabindex="-1"></a>np.mean( ( m_hat <span class="op">&gt;</span> <span class="fl">0.5</span> ) <span class="op">*</span> <span class="dv">1</span> <span class="op">!=</span> d )</span></code></pre></div>
<pre><code>## 0.33605648008068584</code></pre>
</div>
</div>
<p>Let’s sum up the results:</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xtable)</span>
<span id="cb112-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb112-2" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb112-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb112-3" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_plr,forest_plr,tree_plr,boost_plr)</span>
<span id="cb112-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb112-4" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_std_plr,forest_std_plr,tree_std_plr,boost_std_plr)</span>
<span id="cb112-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb112-5" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">3</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_y_rmse,forest_y_rmse,tree_y_rmse,boost_y_rmse)</span>
<span id="cb112-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb112-6" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">4</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_d_rmse,forest_d_rmse,tree_d_rmse,boost_d_rmse)</span>
<span id="cb112-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Estimate&quot;</span>,<span class="st">&quot;Std.Error&quot;</span>,<span class="st">&quot;RMSE Y&quot;</span>,<span class="st">&quot;RMSE D&quot;</span>)</span>
<span id="cb112-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Lasso&quot;</span>,<span class="st">&quot;Random Forest&quot;</span>,<span class="st">&quot;Trees&quot;</span>,<span class="st">&quot;Boosting&quot;</span>)</span>
<span id="cb112-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb112-9" aria-hidden="true" tabindex="-1"></a>tab<span class="ot">&lt;-</span> <span class="fu">xtable</span>(table, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb112-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb112-10" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div>
<pre><code>## % latex table generated in R 4.0.4 by xtable 1.8-4 package
## % Wed Nov 24 15:05:32 2021
## \begin{table}[ht]
## \centering
## \begin{tabular}{rrrrr}
##   \hline
##  &amp; Lasso &amp; Random Forest &amp; Trees &amp; Boosting \\ 
##   \hline
## Estimate &amp; 8952.25 &amp; 8359.37 &amp; 8834.64 &amp; 8867.42 \\ 
##   Std.Error &amp; 1268.61 &amp; 1266.75 &amp; 1317.08 &amp; 1342.33 \\ 
##   RMSE Y &amp; 53735.74 &amp; 56078.76 &amp; 56708.52 &amp; 59816.19 \\ 
##   RMSE D &amp; 0.44 &amp; 0.46 &amp; 0.46 &amp; 0.47 \\ 
##    \hline
## \end{tabular}
## \end{table}</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb114"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb114-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb114-1" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> np.zeros( (<span class="dv">4</span>, <span class="dv">4</span>) )</span>
<span id="cb114-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb114-3" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">0</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_plr,forest_plr[<span class="dv">0</span>],tree_plr[<span class="dv">0</span>],boost_plr[<span class="dv">0</span>]</span>
<span id="cb114-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb114-4" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">1</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_std_plr,forest_std_plr,tree_std_plr,boost_std_plr</span>
<span id="cb114-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb114-5" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">2</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_y_rmse,forest_y_rmse,tree_y_rmse,boost_y_rmse</span>
<span id="cb114-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb114-6" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">3</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_d_rmse,forest_d_rmse,tree_d_rmse,boost_d_rmse</span>
<span id="cb114-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb114-7" aria-hidden="true" tabindex="-1"></a>table_pd <span class="op">=</span> pd.DataFrame( table , index <span class="op">=</span> [<span class="st">&quot;Estimate&quot;</span>,<span class="st">&quot;Std.Error&quot;</span>,<span class="st">&quot;RMSE Y&quot;</span>,<span class="st">&quot;RMSE D&quot;</span> ], <span class="op">\</span></span>
<span id="cb114-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb114-8" aria-hidden="true" tabindex="-1"></a>            columns <span class="op">=</span> [ <span class="st">&quot;Lasso&quot;</span>,<span class="st">&quot;Random Forest&quot;</span>,<span class="st">&quot;Trees&quot;</span>,<span class="st">&quot;Boosting&quot;</span>])</span>
<span id="cb114-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb114-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb114-10" aria-hidden="true" tabindex="-1"></a>table_pd.to_latex()</span></code></pre></div>
<pre><code>## &#39;\\begin{tabular}{lrrrr}\n\\toprule\n{} &amp;         Lasso &amp;  Random Forest &amp;         Trees &amp;      Boosting \\\\\n\\midrule\nEstimate  &amp;   8919.577401 &amp;    8702.588054 &amp;   8601.584926 &amp;   9129.263678 \\\\\nStd.Error &amp;   1325.857662 &amp;    1310.423641 &amp;   1383.825475 &amp;   1471.781415 \\\\\nRMSE Y    &amp;  54342.024308 &amp;   58456.527348 &amp;  58017.721042 &amp;  62126.682372 \\\\\nRMSE D    &amp;      0.458516 &amp;       0.465964 &amp;      0.454669 &amp;      0.462982 \\\\\n\\bottomrule\n\\end{tabular}\n&#39;</code></pre>
</div>
</div>
<p>The best model with lowest RMSE in both equation is the PLR model estimated via lasso. It gives the following estimate:</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb116-1" aria-hidden="true" tabindex="-1"></a>lasso_plr</span></code></pre></div>
<pre><code>##     e401 
## 8952.253</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb118"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb118-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb118-1" aria-hidden="true" tabindex="-1"></a>lasso_plr</span></code></pre></div>
<pre><code>## 8919.577401231152</code></pre>
</div>
</div>
</div>
<div id="interactive-regression-model-irm" class="section level2" number="16.5">
<h2><span class="header-section-number">16.5</span> Interactive Regression Model (IRM)</h2>
<p>Next, we consider estimation of average treatment effects when treatment effects are fully heterogeneous:</p>
<p><span class="math display">\[\begin{eqnarray}\label{eq: HetPL1}
 &amp; Y  = g_0(D, X) + U,  &amp;  \quad E[U \mid X, D]= 0,\\
  &amp; D  = m_0(X) + V,  &amp; \quad  E[V\mid X] = 0.
\end{eqnarray}\]</span></p>
<p>To reduce the disproportionate impact of extreme propensity score weights in the interactive model
we trim the propensity scores which are close to the bounds.</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb120-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-4" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">&quot;mlr3&quot;</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">&quot;warn&quot;</span>) </span>
<span id="cb120-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-7" aria-hidden="true" tabindex="-1"></a>dml_irm <span class="ot">=</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(data_ml_aux, </span>
<span id="cb120-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ml_g =</span> lasso, </span>
<span id="cb120-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ml_m =</span> lasso_class, </span>
<span id="cb120-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>, </span>
<span id="cb120-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n_folds=</span><span class="dv">3</span>)</span>
<span id="cb120-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-14" aria-hidden="true" tabindex="-1"></a>dml_irm<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb120-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb120-17" aria-hidden="true" tabindex="-1"></a>dml_irm<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## e401      7941       1106   7.177 7.15e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb122-1" aria-hidden="true" tabindex="-1"></a>lasso_irm <span class="ot">&lt;-</span> dml_irm<span class="sc">$</span>coef</span>
<span id="cb122-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb122-2" aria-hidden="true" tabindex="-1"></a>lasso_std_irm <span class="ot">&lt;-</span> dml_irm<span class="sc">$</span>se</span>
<span id="cb122-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb122-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb122-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb122-6" aria-hidden="true" tabindex="-1"></a>dml_irm<span class="sc">$</span><span class="fu">params_names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;ml_g0&quot; &quot;ml_g1&quot; &quot;ml_m&quot;</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb124-1" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_irm<span class="sc">$</span>predictions<span class="sc">$</span>ml_g0) <span class="co"># predictions of g_0(D=0, X)</span></span>
<span id="cb124-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb124-2" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_irm<span class="sc">$</span>predictions<span class="sc">$</span>ml_g1) <span class="co"># predictions of g_0(D=1, X)</span></span>
<span id="cb124-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb124-3" aria-hidden="true" tabindex="-1"></a>g_hat <span class="ot">&lt;-</span> d<span class="sc">*</span>g1_hat<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>d)<span class="sc">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb124-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb124-4" aria-hidden="true" tabindex="-1"></a>m_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_irm<span class="sc">$</span>predictions<span class="sc">$</span>ml_m) <span class="co"># predictions of m_o</span></span></code></pre></div>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb125"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb125-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lasso</span></span>
<span id="cb125-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb125-2" aria-hidden="true" tabindex="-1"></a>lasso <span class="op">=</span> make_pipeline(StandardScaler(), LassoCV(cv<span class="op">=</span><span class="dv">5</span>, max_iter<span class="op">=</span><span class="dv">20000</span>))</span>
<span id="cb125-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize DoubleMLIRM model</span></span>
<span id="cb125-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb125-5" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb125-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb125-6" aria-hidden="true" tabindex="-1"></a>dml_irm <span class="op">=</span> dml.DoubleMLIRM(data_ml_aux, ml_g <span class="op">=</span> lasso, ml_m <span class="op">=</span> lasso_class, trimming_threshold <span class="op">=</span> <span class="fl">0.01</span>, n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb125-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb125-8" aria-hidden="true" tabindex="-1"></a>dml_irm.fit(store_predictions<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_irm.DoubleMLIRM object at 0x00000000C4DCA070&gt;</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb127-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb127-1" aria-hidden="true" tabindex="-1"></a>lasso_summary <span class="op">=</span> dml_irm.summary</span>
<span id="cb127-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dml_irm.summary)</span></code></pre></div>
<pre><code>##              coef      std err  ...        2.5 %        97.5 %
## e401  8089.763322  1270.047728  ...  5600.515516  10579.011127
## 
## [1 rows x 6 columns]</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb129-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb129-1" aria-hidden="true" tabindex="-1"></a>lasso_irm <span class="op">=</span> dml_irm.coef[<span class="dv">0</span>]</span>
<span id="cb129-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb129-2" aria-hidden="true" tabindex="-1"></a>lasso_std_irm <span class="op">=</span> dml_irm.se[<span class="dv">0</span>]</span>
<span id="cb129-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb129-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dml_irm.params_names)</span></code></pre></div>
<pre><code>## [&#39;ml_g0&#39;, &#39;ml_g1&#39;, &#39;ml_m&#39;]</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb131-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb131-1" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="op">=</span> dml_irm.predictions[<span class="st">&#39;ml_g0&#39;</span>].flatten() <span class="co"># predictions of g_0(D=0, X)</span></span>
<span id="cb131-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb131-2" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="op">=</span> dml_irm.predictions[<span class="st">&#39;ml_g1&#39;</span>].flatten() <span class="co"># predictions of g_0(D=1, X)</span></span>
<span id="cb131-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb131-3" aria-hidden="true" tabindex="-1"></a>g_hat <span class="op">=</span> d <span class="op">*</span> g1_hat <span class="op">+</span> ( <span class="dv">1</span> <span class="op">-</span> d )<span class="op">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb131-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb131-4" aria-hidden="true" tabindex="-1"></a>m_hat <span class="op">=</span> dml_irm.predictions[<span class="st">&#39;ml_m&#39;</span>].flatten() <span class="co"># predictions of m_o</span></span></code></pre></div>
</div>
</div>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb132-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb132-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>net_tfa) <span class="co"># true observations</span></span>
<span id="cb132-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb132-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>e401) </span>
<span id="cb132-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb132-4" aria-hidden="true" tabindex="-1"></a>lasso_y_irm <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>g_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb132-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb132-5" aria-hidden="true" tabindex="-1"></a>lasso_y_irm</span></code></pre></div>
<pre><code>## [1] 55439.51</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb134-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb134-2" aria-hidden="true" tabindex="-1"></a>lasso_d_irm <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb134-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb134-3" aria-hidden="true" tabindex="-1"></a>lasso_d_irm</span></code></pre></div>
<pre><code>## [1] 0.4440579</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span>
<span id="cb136-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">ifelse</span>(m_hat <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">!=</span> d)</span></code></pre></div>
<pre><code>## [1] 0.3153807</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb138"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb138-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb138-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb138-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pension.net_tfa.to_numpy() <span class="co"># true observations</span></span>
<span id="cb138-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb138-3" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pension.e401.to_numpy()</span>
<span id="cb138-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb138-4" aria-hidden="true" tabindex="-1"></a>lasso_y_irm <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> g_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb138-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lasso_y_irm)</span>
<span id="cb138-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span></code></pre></div>
<pre><code>## 54497.27607070185</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb140-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb140-1" aria-hidden="true" tabindex="-1"></a>lasso_d_irm <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb140-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( lasso_d_irm )</span>
<span id="cb140-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span></code></pre></div>
<pre><code>## 0.45851619758764794</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb142-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb142-1" aria-hidden="true" tabindex="-1"></a>np.mean( ( m_hat <span class="op">&gt;</span> <span class="fl">0.5</span> ) <span class="op">*</span> <span class="dv">1</span> <span class="op">!=</span> d ) </span></code></pre></div>
<pre><code>## 0.31376701966717097</code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="do">##### forest #####</span></span>
<span id="cb144-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-4" aria-hidden="true" tabindex="-1"></a>dml_irm <span class="ot">=</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(data_ml_aux, </span>
<span id="cb144-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ml_g =</span> randomForest, </span>
<span id="cb144-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ml_m =</span> randomForest_class, </span>
<span id="cb144-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>, </span>
<span id="cb144-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n_folds=</span><span class="dv">3</span>)</span>
<span id="cb144-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-11" aria-hidden="true" tabindex="-1"></a>dml_irm<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb144-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb144-14" aria-hidden="true" tabindex="-1"></a>dml_irm<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## e401      7809       1311   5.955  2.6e-09 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-1" aria-hidden="true" tabindex="-1"></a>forest_irm <span class="ot">&lt;-</span> dml_irm<span class="sc">$</span>coef</span>
<span id="cb146-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-2" aria-hidden="true" tabindex="-1"></a>forest_std_irm <span class="ot">&lt;-</span> dml_plr<span class="sc">$</span>se</span>
<span id="cb146-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb146-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-5" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_irm<span class="sc">$</span>predictions<span class="sc">$</span>ml_g0) <span class="co"># predictions of g_0(D=0, X)</span></span>
<span id="cb146-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-6" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_irm<span class="sc">$</span>predictions<span class="sc">$</span>ml_g1) <span class="co"># predictions of g_0(D=1, X)</span></span>
<span id="cb146-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-7" aria-hidden="true" tabindex="-1"></a>g_hat <span class="ot">&lt;-</span> d<span class="sc">*</span>g1_hat<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>d)<span class="sc">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb146-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-8" aria-hidden="true" tabindex="-1"></a>m_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_irm<span class="sc">$</span>predictions<span class="sc">$</span>ml_m) <span class="co"># predictions of m_o</span></span>
<span id="cb146-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb146-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-11" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>net_tfa) <span class="co"># true observations</span></span>
<span id="cb146-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-12" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>e401) </span>
<span id="cb146-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-13" aria-hidden="true" tabindex="-1"></a>forest_y_irm <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>g_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb146-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb146-14" aria-hidden="true" tabindex="-1"></a>forest_y_irm</span></code></pre></div>
<pre><code>## [1] 55502.95</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb148-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb148-2" aria-hidden="true" tabindex="-1"></a>forest_d_irm <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb148-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb148-3" aria-hidden="true" tabindex="-1"></a>forest_d_irm</span></code></pre></div>
<pre><code>## [1] 0.4559869</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span>
<span id="cb150-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">ifelse</span>(m_hat <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">!=</span> d)</span></code></pre></div>
<pre><code>## [1] 0.3290973</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="do">##### trees #####</span></span>
<span id="cb152-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-4" aria-hidden="true" tabindex="-1"></a>dml_irm <span class="ot">&lt;-</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(data_ml_aux, </span>
<span id="cb152-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ml_g =</span> trees, </span>
<span id="cb152-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ml_m =</span> trees_class, </span>
<span id="cb152-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>, </span>
<span id="cb152-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">n_folds=</span><span class="dv">3</span>)</span>
<span id="cb152-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-11" aria-hidden="true" tabindex="-1"></a>dml_irm<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb152-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb152-13" aria-hidden="true" tabindex="-1"></a>dml_irm<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## e401      7477       1187     6.3 2.97e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-1" aria-hidden="true" tabindex="-1"></a>tree_irm <span class="ot">&lt;-</span> dml_irm<span class="sc">$</span>coef</span>
<span id="cb154-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-2" aria-hidden="true" tabindex="-1"></a>tree_std_irm <span class="ot">&lt;-</span> dml_irm<span class="sc">$</span>se</span>
<span id="cb154-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb154-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-5" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_irm<span class="sc">$</span>predictions<span class="sc">$</span>ml_g0) <span class="co"># predictions of g_0(D=0, X)</span></span>
<span id="cb154-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-6" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_irm<span class="sc">$</span>predictions<span class="sc">$</span>ml_g1) <span class="co"># predictions of g_0(D=1, X)</span></span>
<span id="cb154-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-7" aria-hidden="true" tabindex="-1"></a>g_hat <span class="ot">&lt;-</span> d<span class="sc">*</span>g1_hat<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>d)<span class="sc">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb154-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-8" aria-hidden="true" tabindex="-1"></a>m_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_irm<span class="sc">$</span>predictions<span class="sc">$</span>ml_m) <span class="co"># predictions of m_o</span></span>
<span id="cb154-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb154-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-11" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>net_tfa) <span class="co"># true observations</span></span>
<span id="cb154-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-12" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>e401) </span>
<span id="cb154-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-13" aria-hidden="true" tabindex="-1"></a>tree_y_irm <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>g_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb154-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb154-14" aria-hidden="true" tabindex="-1"></a>tree_y_irm</span></code></pre></div>
<pre><code>## [1] 57305.26</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb156-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb156-2" aria-hidden="true" tabindex="-1"></a>tree_d_irm <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb156-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb156-3" aria-hidden="true" tabindex="-1"></a>tree_d_irm</span></code></pre></div>
<pre><code>## [1] 0.455894</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span>
<span id="cb158-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">ifelse</span>(m_hat <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">!=</span> d)</span></code></pre></div>
<pre><code>## [1] 0.3135653</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="do">##### boosting #####</span></span>
<span id="cb160-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb160-3" aria-hidden="true" tabindex="-1"></a>dml_irm <span class="ot">&lt;-</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(data_ml_aux, </span>
<span id="cb160-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb160-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ml_g =</span> boost, </span>
<span id="cb160-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb160-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ml_m =</span> boost_class,</span>
<span id="cb160-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb160-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>, </span>
<span id="cb160-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb160-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">n_folds=</span><span class="dv">3</span>)</span>
<span id="cb160-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb160-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb160-9" aria-hidden="true" tabindex="-1"></a>dml_irm<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb160-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb160-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb160-11" aria-hidden="true" tabindex="-1"></a>dml_irm<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## e401      8353       1228   6.803 1.03e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-1" aria-hidden="true" tabindex="-1"></a>boost_irm <span class="ot">&lt;-</span> dml_irm<span class="sc">$</span>coef</span>
<span id="cb162-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-2" aria-hidden="true" tabindex="-1"></a>boost_std_irm <span class="ot">&lt;-</span> dml_irm<span class="sc">$</span>se</span>
<span id="cb162-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb162-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-5" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_irm<span class="sc">$</span>predictions<span class="sc">$</span>ml_g0) <span class="co"># predictions of g_0(D=0, X)</span></span>
<span id="cb162-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-6" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_irm<span class="sc">$</span>predictions<span class="sc">$</span>ml_g1) <span class="co"># predictions of g_0(D=1, X)</span></span>
<span id="cb162-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-7" aria-hidden="true" tabindex="-1"></a>g_hat <span class="ot">&lt;-</span> d<span class="sc">*</span>g1_hat<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>d)<span class="sc">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb162-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-8" aria-hidden="true" tabindex="-1"></a>m_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_irm<span class="sc">$</span>predictions<span class="sc">$</span>ml_m) <span class="co"># predictions of m_o</span></span>
<span id="cb162-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb162-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-11" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>net_tfa) <span class="co"># true observations</span></span>
<span id="cb162-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-12" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>e401) </span>
<span id="cb162-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-13" aria-hidden="true" tabindex="-1"></a>boost_y_irm <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>g_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb162-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb162-14" aria-hidden="true" tabindex="-1"></a>boost_y_irm</span></code></pre></div>
<pre><code>## [1] 61055.91</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb164-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb164-2" aria-hidden="true" tabindex="-1"></a>boost_d_irm <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb164-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb164-3" aria-hidden="true" tabindex="-1"></a>boost_d_irm</span></code></pre></div>
<pre><code>## [1] 0.4732346</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span>
<span id="cb166-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">ifelse</span>(m_hat <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">!=</span> d)</span></code></pre></div>
<pre><code>## [1] 0.3234493</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb168"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb168-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co">##### forest #####</span></span>
<span id="cb168-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb168-2" aria-hidden="true" tabindex="-1"></a>randomForest <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb168-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb168-3" aria-hidden="true" tabindex="-1"></a>randomForest_class <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb168-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb168-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb168-5" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb168-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb168-6" aria-hidden="true" tabindex="-1"></a>dml_irm <span class="op">=</span> dml.DoubleMLIRM(data_ml_aux,</span>
<span id="cb168-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb168-7" aria-hidden="true" tabindex="-1"></a>                                 ml_g <span class="op">=</span> randomForest,</span>
<span id="cb168-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb168-8" aria-hidden="true" tabindex="-1"></a>                                 ml_m <span class="op">=</span> randomForest_class,</span>
<span id="cb168-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb168-9" aria-hidden="true" tabindex="-1"></a>                                 trimming_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb168-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb168-10" aria-hidden="true" tabindex="-1"></a>                                 n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb168-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb168-11" aria-hidden="true" tabindex="-1"></a>dml_irm.fit( store_predictions <span class="op">=</span> <span class="va">True</span> ) </span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_irm.DoubleMLIRM object at 0x0000000064929A30&gt;</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb170-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( dml_irm.summary )</span></code></pre></div>
<pre><code>##              coef      std err  ...        2.5 %       97.5 %
## e401  8429.821206  1521.201806  ...  5448.320453  11411.32196
## 
## [1 rows x 6 columns]</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb172-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-1" aria-hidden="true" tabindex="-1"></a>forest_irm <span class="op">=</span> dml_irm.coef[ <span class="dv">0</span> ]</span>
<span id="cb172-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-2" aria-hidden="true" tabindex="-1"></a>forest_std_irm <span class="op">=</span> dml_irm.se[ <span class="dv">0</span> ]</span>
<span id="cb172-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb172-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-5" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="op">=</span> dml_irm.predictions[<span class="st">&#39;ml_g0&#39;</span>].flatten() <span class="co"># predictions of g_0(D=0, X)</span></span>
<span id="cb172-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-6" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="op">=</span> dml_irm.predictions[<span class="st">&#39;ml_g1&#39;</span>].flatten() <span class="co"># predictions of g_0(D=1, X)</span></span>
<span id="cb172-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-7" aria-hidden="true" tabindex="-1"></a>g_hat <span class="op">=</span> d <span class="op">*</span> g1_hat <span class="op">+</span> ( <span class="dv">1</span> <span class="op">-</span> d )<span class="op">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb172-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-8" aria-hidden="true" tabindex="-1"></a>m_hat <span class="op">=</span> dml_irm.predictions[<span class="st">&#39;ml_m&#39;</span>].flatten() <span class="co"># predictions of m_o</span></span>
<span id="cb172-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb172-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-11" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pension.net_tfa.to_numpy()</span>
<span id="cb172-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-12" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pension.e401.to_numpy()</span>
<span id="cb172-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-13" aria-hidden="true" tabindex="-1"></a>forest_y_irm <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> g_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb172-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( forest_y_irm )</span>
<span id="cb172-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb172-16" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span></code></pre></div>
<pre><code>## 56839.92174410771</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb174-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb174-1" aria-hidden="true" tabindex="-1"></a>forest_d_irm <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb174-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( forest_d_irm )</span>
<span id="cb174-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb174-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span></code></pre></div>
<pre><code>## 0.46312674664653625</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb176-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb176-1" aria-hidden="true" tabindex="-1"></a>np.mean( ( m_hat <span class="op">&gt;</span> <span class="fl">0.5</span> ) <span class="op">*</span> <span class="dv">1</span> <span class="op">!=</span> d )</span>
<span id="cb176-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb176-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="co">##### trees #####</span></span></code></pre></div>
<pre><code>## 0.33767019667170955</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb178-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb178-1" aria-hidden="true" tabindex="-1"></a>trees <span class="op">=</span> DecisionTreeRegressor( max_depth<span class="op">=</span><span class="dv">30</span>, ccp_alpha<span class="op">=</span><span class="fl">0.01</span>, min_samples_split<span class="op">=</span><span class="dv">20</span>, min_samples_leaf<span class="op">=</span><span class="dv">67</span>)</span>
<span id="cb178-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb178-2" aria-hidden="true" tabindex="-1"></a>trees_class <span class="op">=</span> DecisionTreeClassifier( max_depth<span class="op">=</span><span class="dv">30</span>, ccp_alpha<span class="op">=</span><span class="fl">0.01</span>, min_samples_split<span class="op">=</span><span class="dv">20</span>, min_samples_leaf<span class="op">=</span><span class="dv">34</span>)</span>
<span id="cb178-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb178-3" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb178-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb178-4" aria-hidden="true" tabindex="-1"></a>dml_irm <span class="op">=</span> dml.DoubleMLIRM(data_ml_aux,</span>
<span id="cb178-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb178-5" aria-hidden="true" tabindex="-1"></a>                                 ml_g <span class="op">=</span> trees,</span>
<span id="cb178-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb178-6" aria-hidden="true" tabindex="-1"></a>                                 ml_m <span class="op">=</span> trees_class,</span>
<span id="cb178-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb178-7" aria-hidden="true" tabindex="-1"></a>                                 trimming_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb178-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb178-8" aria-hidden="true" tabindex="-1"></a>                                 n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb178-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb178-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb178-10" aria-hidden="true" tabindex="-1"></a>dml_irm.fit( store_predictions <span class="op">=</span> <span class="va">True</span> ) </span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_irm.DoubleMLIRM object at 0x00000000C4DD63D0&gt;</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb180-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dml_irm.summary)</span></code></pre></div>
<pre><code>##              coef      std err  ...        2.5 %       97.5 %
## e401  7462.262513  1171.316712  ...  5166.523942  9758.001083
## 
## [1 rows x 6 columns]</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb182-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-1" aria-hidden="true" tabindex="-1"></a>tree_irm <span class="op">=</span> dml_irm.coef[ <span class="dv">0</span> ]</span>
<span id="cb182-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-2" aria-hidden="true" tabindex="-1"></a>tree_std_irm <span class="op">=</span> dml_irm.se[ <span class="dv">0</span> ]</span>
<span id="cb182-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-6" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb182-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-7" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="op">=</span> dml_irm.predictions[<span class="st">&#39;ml_g0&#39;</span>].flatten() <span class="co"># predictions of g_0(D=0, X)</span></span>
<span id="cb182-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-8" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="op">=</span> dml_irm.predictions[<span class="st">&#39;ml_g1&#39;</span>].flatten() <span class="co"># predictions of g_0(D=1, X)</span></span>
<span id="cb182-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-9" aria-hidden="true" tabindex="-1"></a>g_hat <span class="op">=</span> d <span class="op">*</span> g1_hat <span class="op">+</span> ( <span class="dv">1</span> <span class="op">-</span> d )<span class="op">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb182-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-10" aria-hidden="true" tabindex="-1"></a>m_hat <span class="op">=</span> dml_irm.predictions[<span class="st">&#39;ml_m&#39;</span>].flatten() <span class="co"># predictions of m_o</span></span>
<span id="cb182-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-12" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb182-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-13" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pension.net_tfa.to_numpy()</span>
<span id="cb182-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-14" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pension.e401.to_numpy()</span>
<span id="cb182-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-15" aria-hidden="true" tabindex="-1"></a>tree_y_irm <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> g_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb182-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( tree_y_irm )</span>
<span id="cb182-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-18"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb182-18" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span></code></pre></div>
<pre><code>## 56517.04167292204</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb184-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb184-1" aria-hidden="true" tabindex="-1"></a>tree_d_irm <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb184-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( tree_d_irm )</span>
<span id="cb184-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb184-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span></code></pre></div>
<pre><code>## 0.4546690531536573</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb186-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb186-1" aria-hidden="true" tabindex="-1"></a>np.mean( ( m_hat <span class="op">&gt;</span> <span class="fl">0.5</span> ) <span class="op">*</span> <span class="dv">1</span> <span class="op">!=</span> d )</span>
<span id="cb186-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb186-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="co">##### boosting #####</span></span></code></pre></div>
<pre><code>## 0.35269793242561776</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb188-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb188-1" aria-hidden="true" tabindex="-1"></a>boost <span class="op">=</span> XGBRegressor(n_jobs<span class="op">=</span><span class="dv">1</span>, objective <span class="op">=</span> <span class="st">&quot;reg:squarederror&quot;</span>)</span>
<span id="cb188-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb188-2" aria-hidden="true" tabindex="-1"></a>boost_class <span class="op">=</span> XGBClassifier(use_label_encoder<span class="op">=</span><span class="va">False</span>, n_jobs<span class="op">=</span><span class="dv">1</span>, </span>
<span id="cb188-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb188-3" aria-hidden="true" tabindex="-1"></a>                objective <span class="op">=</span> <span class="st">&quot;binary:logistic&quot;</span>, </span>
<span id="cb188-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb188-4" aria-hidden="true" tabindex="-1"></a>                eval_metric <span class="op">=</span> <span class="st">&quot;logloss&quot;</span>)</span>
<span id="cb188-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb188-5" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb188-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb188-6" aria-hidden="true" tabindex="-1"></a>dml_irm <span class="op">=</span> dml.DoubleMLIRM(data_ml_aux, ml_g <span class="op">=</span> boost, ml_m <span class="op">=</span> boost_class, </span>
<span id="cb188-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb188-7" aria-hidden="true" tabindex="-1"></a>              trimming_threshold <span class="op">=</span> <span class="fl">0.01</span>, n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb188-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb188-8" aria-hidden="true" tabindex="-1"></a>dml_irm.fit( store_predictions <span class="op">=</span> <span class="va">True</span> ) </span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_irm.DoubleMLIRM object at 0x00000000C4DCA070&gt;</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb190-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( dml_irm.summary )</span></code></pre></div>
<pre><code>##              coef      std err        t     P&gt;|t|        2.5 %       97.5 %
## e401  9756.926817  2500.320649  3.90227  0.000095  4856.388395  14657.46524</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb192-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-1" aria-hidden="true" tabindex="-1"></a>boost_irm <span class="op">=</span> dml_irm.coef[ <span class="dv">0</span> ]</span>
<span id="cb192-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-2" aria-hidden="true" tabindex="-1"></a>boost_std_irm <span class="op">=</span> dml_irm.se[ <span class="dv">0</span> ]</span>
<span id="cb192-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb192-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-5" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="op">=</span> dml_irm.predictions[<span class="st">&#39;ml_g0&#39;</span>].flatten() <span class="co"># predictions of g_0(D=0, X)</span></span>
<span id="cb192-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-6" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="op">=</span> dml_irm.predictions[<span class="st">&#39;ml_g1&#39;</span>].flatten() <span class="co"># predictions of g_0(D=1, X)</span></span>
<span id="cb192-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-7" aria-hidden="true" tabindex="-1"></a>g_hat <span class="op">=</span> d <span class="op">*</span> g1_hat <span class="op">+</span> ( <span class="dv">1</span> <span class="op">-</span> d )<span class="op">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb192-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-8" aria-hidden="true" tabindex="-1"></a>m_hat <span class="op">=</span> dml_irm.predictions[<span class="st">&#39;ml_m&#39;</span>].flatten() <span class="co"># predictions of m_o</span></span>
<span id="cb192-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb192-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-11" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pension.net_tfa.to_numpy()</span>
<span id="cb192-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-12" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pension.e401.to_numpy()</span>
<span id="cb192-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-13" aria-hidden="true" tabindex="-1"></a>boost_y_irm <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> g_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb192-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( boost_y_irm )</span>
<span id="cb192-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb192-16" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span></code></pre></div>
<pre><code>## 61594.80967416296</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb194-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb194-1" aria-hidden="true" tabindex="-1"></a>boost_d_irm <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb194-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( boost_d_irm )</span>
<span id="cb194-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb194-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted ce: treatment</span></span></code></pre></div>
<pre><code>## 0.46296289075787445</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb196-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb196-1" aria-hidden="true" tabindex="-1"></a>np.mean( ( m_hat <span class="op">&gt;</span> <span class="fl">0.5</span> ) <span class="op">*</span> <span class="dv">1</span> <span class="op">!=</span> d ) </span></code></pre></div>
<pre><code>## 0.33605648008068584</code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xtable)</span>
<span id="cb198-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb198-2" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb198-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb198-3" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_irm,forest_irm,tree_irm,boost_irm)</span>
<span id="cb198-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb198-4" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_std_irm,forest_std_irm,tree_std_irm,boost_std_irm)</span>
<span id="cb198-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb198-5" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">3</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_y_irm,forest_y_irm,tree_y_irm,boost_y_irm)</span>
<span id="cb198-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb198-6" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">4</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_d_irm,forest_d_irm,tree_d_irm,boost_d_irm)</span>
<span id="cb198-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Estimate&quot;</span>,<span class="st">&quot;Std.Error&quot;</span>,<span class="st">&quot;RMSE Y&quot;</span>,<span class="st">&quot;RMSE D&quot;</span>)</span>
<span id="cb198-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Lasso&quot;</span>,<span class="st">&quot;Random Forest&quot;</span>,<span class="st">&quot;Trees&quot;</span>,<span class="st">&quot;Boosting&quot;</span>)</span>
<span id="cb198-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb198-9" aria-hidden="true" tabindex="-1"></a>tab<span class="ot">&lt;-</span> <span class="fu">xtable</span>(table, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb198-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb198-10" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div>
<pre><code>## % latex table generated in R 4.0.4 by xtable 1.8-4 package
## % Wed Nov 24 15:08:21 2021
## \begin{table}[ht]
## \centering
## \begin{tabular}{rrrrr}
##   \hline
##  &amp; Lasso &amp; Random Forest &amp; Trees &amp; Boosting \\ 
##   \hline
## Estimate &amp; 7941.05 &amp; 7808.95 &amp; 7477.07 &amp; 8353.33 \\ 
##   Std.Error &amp; 1106.52 &amp; 1342.33 &amp; 1186.75 &amp; 1227.92 \\ 
##   RMSE Y &amp; 55439.51 &amp; 55502.95 &amp; 57305.26 &amp; 61055.91 \\ 
##   RMSE D &amp; 0.44 &amp; 0.46 &amp; 0.46 &amp; 0.47 \\ 
##    \hline
## \end{tabular}
## \end{table}</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb200"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb200-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb200-1" aria-hidden="true" tabindex="-1"></a>table2 <span class="op">=</span> np.zeros( (<span class="dv">4</span>, <span class="dv">4</span>) )</span>
<span id="cb200-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb200-2" aria-hidden="true" tabindex="-1"></a>table2[<span class="dv">0</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_irm,forest_irm,tree_irm,boost_irm</span>
<span id="cb200-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb200-3" aria-hidden="true" tabindex="-1"></a>table2[<span class="dv">1</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_std_irm,forest_std_irm,tree_std_irm,boost_std_irm</span>
<span id="cb200-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb200-4" aria-hidden="true" tabindex="-1"></a>table2[<span class="dv">2</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_y_irm,forest_y_irm,tree_y_irm,boost_y_irm</span>
<span id="cb200-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb200-5" aria-hidden="true" tabindex="-1"></a>table2[<span class="dv">3</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_d_irm,forest_d_irm,tree_d_irm,boost_d_irm</span>
<span id="cb200-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb200-6" aria-hidden="true" tabindex="-1"></a>table2_pd <span class="op">=</span> pd.DataFrame( </span>
<span id="cb200-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb200-7" aria-hidden="true" tabindex="-1"></a>        table2 , </span>
<span id="cb200-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb200-8" aria-hidden="true" tabindex="-1"></a>        index <span class="op">=</span> [<span class="st">&quot;Estimate&quot;</span>,<span class="st">&quot;Std.Error&quot;</span>,<span class="st">&quot;RMSE Y&quot;</span>,<span class="st">&quot;RMSE D&quot;</span> ], <span class="op">\</span></span>
<span id="cb200-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb200-9" aria-hidden="true" tabindex="-1"></a>            columns <span class="op">=</span> [ <span class="st">&quot;Lasso&quot;</span>,<span class="st">&quot;Random Forest&quot;</span>,<span class="st">&quot;Trees&quot;</span>,<span class="st">&quot;Boosting&quot;</span>])</span>
<span id="cb200-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb200-10" aria-hidden="true" tabindex="-1"></a>table2_pd.to_latex()</span></code></pre></div>
<pre><code>## &#39;\\begin{tabular}{lrrrr}\n\\toprule\n{} &amp;         Lasso &amp;  Random Forest &amp;         Trees &amp;      Boosting \\\\\n\\midrule\nEstimate  &amp;   8089.763322 &amp;    8429.821206 &amp;   7462.262513 &amp;   9756.926817 \\\\\nStd.Error &amp;   1270.047728 &amp;    1521.201806 &amp;   1171.316712 &amp;   2500.320649 \\\\\nRMSE Y    &amp;  54497.276071 &amp;   56839.921744 &amp;  56517.041673 &amp;  61594.809674 \\\\\nRMSE D    &amp;      0.458516 &amp;       0.463127 &amp;      0.454669 &amp;      0.462963 \\\\\n\\bottomrule\n\\end{tabular}\n&#39;</code></pre>
</div>
</div>
<p>Here, Random Forest gives the best prediction rule for <span class="math inline">\(g_0\)</span> and Lasso the best prediction rule for <span class="math inline">\(m_0\)</span>, respectively. Let us fit the IRM model using the best ML method for each equation to get a final estimate for the treatment effect of eligibility.</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb202-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-3" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">&quot;mlr3&quot;</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">&quot;warn&quot;</span>) </span>
<span id="cb202-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-5" aria-hidden="true" tabindex="-1"></a>dml_irm <span class="ot">=</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(data_ml_aux, </span>
<span id="cb202-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ml_g =</span> randomForest, </span>
<span id="cb202-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ml_m =</span> lasso_class, </span>
<span id="cb202-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>, </span>
<span id="cb202-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n_folds=</span><span class="dv">3</span>)</span>
<span id="cb202-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-11" aria-hidden="true" tabindex="-1"></a>dml_irm<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb202-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb202-13" aria-hidden="true" tabindex="-1"></a>dml_irm<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## e401      8286       1118   7.411 1.25e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb204-1" aria-hidden="true" tabindex="-1"></a>best_irm <span class="ot">&lt;-</span> dml_irm<span class="sc">$</span>coef</span>
<span id="cb204-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb204-2" aria-hidden="true" tabindex="-1"></a>best_std_irm <span class="ot">&lt;-</span> dml_irm<span class="sc">$</span>se</span></code></pre></div>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb205"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb205-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb205-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb205-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb205-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb205-3" aria-hidden="true" tabindex="-1"></a>dml_irm <span class="op">=</span> dml.DoubleMLIRM(data_ml_aux,</span>
<span id="cb205-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb205-4" aria-hidden="true" tabindex="-1"></a>                          ml_g <span class="op">=</span> randomForest,</span>
<span id="cb205-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb205-5" aria-hidden="true" tabindex="-1"></a>                          ml_m <span class="op">=</span> lasso_class,</span>
<span id="cb205-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb205-6" aria-hidden="true" tabindex="-1"></a>                          trimming_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb205-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb205-7" aria-hidden="true" tabindex="-1"></a>                          n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb205-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb205-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb205-9" aria-hidden="true" tabindex="-1"></a>dml_irm.fit(store_predictions<span class="op">=</span><span class="va">True</span>) </span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_irm.DoubleMLIRM object at 0x000000000C648C10&gt;</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb207-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( dml_irm.summary )</span></code></pre></div>
<pre><code>##              coef      std err  ...        2.5 %        97.5 %
## e401  8403.399751  1348.088788  ...  5761.194279  11045.605224
## 
## [1 rows x 6 columns]</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb209-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb209-1" aria-hidden="true" tabindex="-1"></a>best_irm <span class="op">=</span> dml_irm.coef[<span class="dv">0</span>]</span>
<span id="cb209-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb209-2" aria-hidden="true" tabindex="-1"></a>best_std_irm <span class="op">=</span> dml_irm.se[<span class="dv">0</span>]</span></code></pre></div>
</div>
</div>
<p>These estimates that flexibly account for confounding are
substantially attenuated relative to the baseline estimate (<em>19559</em>) that does not account for confounding. They suggest much smaller causal effects of 401(k) eligiblity on financial asset holdings.</p>
</div>
<div id="local-average-treatment-effects-of-401k-participation-on-net-financial-assets" class="section level2" number="16.6">
<h2><span class="header-section-number">16.6</span> Local Average Treatment Effects of 401(k) Participation on Net Financial Assets</h2>
</div>
<div id="interactive-iv-model-iivm" class="section level2" number="16.7">
<h2><span class="header-section-number">16.7</span> Interactive IV Model (IIVM)</h2>
<p>Now, we consider estimation of local average treatment effects (LATE) of participation with the binary instrument <code>e401</code>. As before, <span class="math inline">\(Y\)</span> denotes the outcome <code>net_tfa</code>, and <span class="math inline">\(X\)</span> is the vector of covariates. Here the structural equation model is:</p>
<p><span class="math display">\[\begin{eqnarray}
&amp; Y = g_0(Z,X) + U, &amp;\quad E[U\mid Z,X] = 0,\\
&amp; D = r_0(Z,X) + V, &amp;\quad E[V\mid Z, X] = 0,\\
&amp; Z = m_0(X) + \zeta, &amp;\quad E[\zeta \mid X] = 0.
\end{eqnarray}\]</span></p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Constructing the data (as DoubleMLData)</span></span>
<span id="cb210-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-3" aria-hidden="true" tabindex="-1"></a>formula_flex2 <span class="ot">=</span> <span class="st">&quot;net_tfa ~ p401+ e401 + </span></span>
<span id="cb210-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-4" aria-hidden="true" tabindex="-1"></a><span class="st">                poly(age, 6, raw=TRUE) + </span></span>
<span id="cb210-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-5" aria-hidden="true" tabindex="-1"></a><span class="st">                poly(inc, 6, raw=TRUE) + </span></span>
<span id="cb210-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-6" aria-hidden="true" tabindex="-1"></a><span class="st">                poly(educ, 4, raw=TRUE) + </span></span>
<span id="cb210-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-7" aria-hidden="true" tabindex="-1"></a><span class="st">                poly(fsize, 2, raw=TRUE) + </span></span>
<span id="cb210-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-8" aria-hidden="true" tabindex="-1"></a><span class="st">                marr + twoearn + db + </span></span>
<span id="cb210-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-9" aria-hidden="true" tabindex="-1"></a><span class="st">                pira + hown&quot;</span></span>
<span id="cb210-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-12" aria-hidden="true" tabindex="-1"></a>model_flex2 <span class="ot">=</span> <span class="fu">as.data.table</span>(<span class="fu">model.frame</span>(formula_flex2, data))</span>
<span id="cb210-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-15" aria-hidden="true" tabindex="-1"></a>x_cols <span class="ot">=</span> <span class="fu">colnames</span>(model_flex2)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)]</span>
<span id="cb210-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-18"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb210-18" aria-hidden="true" tabindex="-1"></a>data_IV_aux <span class="ot">=</span> DoubleMLData<span class="sc">$</span><span class="fu">new</span>(model_flex2, <span class="at">y_col =</span> <span class="st">&quot;net_tfa&quot;</span>, <span class="at">d_cols =</span> <span class="st">&quot;p401&quot;</span>, <span class="at">z_cols =</span><span class="st">&quot;e401&quot;</span>,<span class="at">x_cols=</span>x_cols)</span></code></pre></div>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb211"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb211-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Constructing the data (as DoubleMLData)</span></span>
<span id="cb211-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> data.copy()[[<span class="st">&#39;marr&#39;</span>, <span class="st">&#39;twoearn&#39;</span>, <span class="st">&#39;db&#39;</span>, <span class="st">&#39;pira&#39;</span>, <span class="st">&#39;hown&#39;</span>]]</span>
<span id="cb211-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-3" aria-hidden="true" tabindex="-1"></a>poly_dict <span class="op">=</span> {<span class="st">&#39;age&#39;</span>: <span class="dv">6</span>, <span class="st">&#39;inc&#39;</span>: <span class="dv">6</span>, <span class="st">&#39;educ&#39;</span>: <span class="dv">4</span>, <span class="st">&#39;fsize&#39;</span>: <span class="dv">2</span>}</span>
<span id="cb211-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, degree <span class="kw">in</span> poly_dict.items():</span>
<span id="cb211-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-5" aria-hidden="true" tabindex="-1"></a>    poly <span class="op">=</span> PolynomialFeatures(degree, include_bias<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb211-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-6" aria-hidden="true" tabindex="-1"></a>    data_transf <span class="op">=</span> poly.fit_transform(data[[key]])</span>
<span id="cb211-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-7" aria-hidden="true" tabindex="-1"></a>    x_cols <span class="op">=</span> poly.get_feature_names([key])</span>
<span id="cb211-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-8" aria-hidden="true" tabindex="-1"></a>    data_transf <span class="op">=</span> pd.DataFrame(data_transf, columns<span class="op">=</span>x_cols)    </span>
<span id="cb211-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-9" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> pd.concat((features, data_transf),</span>
<span id="cb211-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-10" aria-hidden="true" tabindex="-1"></a>                          axis<span class="op">=</span><span class="dv">1</span>, sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb211-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-11" aria-hidden="true" tabindex="-1"></a>model_flex2 <span class="op">=</span> pd.concat((data.copy()[[<span class="st">&#39;net_tfa&#39;</span>, <span class="st">&#39;p401&#39;</span> , <span class="st">&#39;e401&#39;</span>]], features.copy()),</span>
<span id="cb211-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-12" aria-hidden="true" tabindex="-1"></a>                        axis<span class="op">=</span><span class="dv">1</span>, sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb211-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-13" aria-hidden="true" tabindex="-1"></a>x_cols <span class="op">=</span> model_flex2.columns.to_list()[<span class="dv">3</span>:]</span>
<span id="cb211-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize DoubleMLData (data-backend of DoubleML)</span></span>
<span id="cb211-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-15" aria-hidden="true" tabindex="-1"></a>data_IV_aux <span class="op">=</span> dml.DoubleMLData(model_flex2, y_col<span class="op">=</span><span class="st">&#39;net_tfa&#39;</span>, <span class="op">\</span></span>
<span id="cb211-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-16" aria-hidden="true" tabindex="-1"></a>                               d_cols <span class="op">=</span><span class="st">&#39;p401&#39;</span> , z_cols <span class="op">=</span> <span class="st">&#39;e401&#39;</span> , <span class="op">\</span></span>
<span id="cb211-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb211-17" aria-hidden="true" tabindex="-1"></a>                               x_cols <span class="op">=</span> x_cols)</span></code></pre></div>
</div>
</div>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb212-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-3" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">&quot;mlr3&quot;</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">&quot;warn&quot;</span>) </span>
<span id="cb212-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-5" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM <span class="ot">=</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(data_IV_aux, </span>
<span id="cb212-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_g =</span> lasso, </span>
<span id="cb212-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_m =</span> lasso_class, </span>
<span id="cb212-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_r =</span> lasso_class, </span>
<span id="cb212-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n_folds=</span><span class="dv">3</span>, </span>
<span id="cb212-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>, </span>
<span id="cb212-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-11" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">never_takers =</span> <span class="cn">TRUE</span>))</span>
<span id="cb212-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-13" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb212-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb212-15" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## p401     11484       1596   7.195 6.25e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb214-1" aria-hidden="true" tabindex="-1"></a>lasso_MLIIVM <span class="ot">&lt;-</span> dml_MLIIVM<span class="sc">$</span>coef</span>
<span id="cb214-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb214-2" aria-hidden="true" tabindex="-1"></a>lasso_std_MLIIVM <span class="ot">&lt;-</span> dml_MLIIVM<span class="sc">$</span>se</span></code></pre></div>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb215"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb215-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lasso</span></span>
<span id="cb215-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-2" aria-hidden="true" tabindex="-1"></a>lasso <span class="op">=</span> make_pipeline(StandardScaler(), LassoCV(cv<span class="op">=</span><span class="dv">5</span>, max_iter<span class="op">=</span><span class="dv">20000</span>))</span>
<span id="cb215-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize DoubleMLIRM model</span></span>
<span id="cb215-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-5" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb215-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-6" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM <span class="op">=</span> dml.DoubleMLIIVM(data_IV_aux, </span>
<span id="cb215-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-7" aria-hidden="true" tabindex="-1"></a>                ml_g <span class="op">=</span> lasso, </span>
<span id="cb215-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-8" aria-hidden="true" tabindex="-1"></a>                ml_m <span class="op">=</span> lasso_class,</span>
<span id="cb215-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-9" aria-hidden="true" tabindex="-1"></a>        ml_r <span class="op">=</span> lasso_class,</span>
<span id="cb215-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-10" aria-hidden="true" tabindex="-1"></a>        subgroups <span class="op">=</span> {<span class="st">&#39;always_takers&#39;</span>: <span class="va">False</span>,</span>
<span id="cb215-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;never_takers&#39;</span>: <span class="va">True</span>},</span>
<span id="cb215-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-12" aria-hidden="true" tabindex="-1"></a>        trimming_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb215-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-13" aria-hidden="true" tabindex="-1"></a>        n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb215-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb215-15" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM.fit(store_predictions<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_iivm.DoubleMLIIVM object at 0x00000000614DAF70&gt;</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb217-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( dml_MLIIVM.summary )</span></code></pre></div>
<pre><code>##               coef      std err  ...        2.5 %        97.5 %
## p401  11764.551405  1842.601194  ...  8153.119428  15375.983383
## 
## [1 rows x 6 columns]</code></pre>
<div class="sourceCode" id="cb219"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb219-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb219-1" aria-hidden="true" tabindex="-1"></a>lasso_MLIIVM <span class="op">=</span> dml_MLIIVM.coef[ <span class="dv">0</span> ]</span>
<span id="cb219-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb219-2" aria-hidden="true" tabindex="-1"></a>lasso_std_MLIIVM <span class="op">=</span> dml_MLIIVM.se[ <span class="dv">0</span> ]</span></code></pre></div>
</div>
</div>
<p>The confidence interval for the local average treatment effect of participation is given by</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb220-1" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM<span class="sc">$</span><span class="fu">confint</span>(<span class="at">level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##         2.5 %   97.5 %
## p401 8356.038 14612.92</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb222"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb222-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb222-1" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM.confint()</span></code></pre></div>
<pre><code>##             2.5 %        97.5 %
## p401  8153.119428  15375.983383</code></pre>
</div>
</div>
<p>Here we can also check the accuracy of the model:</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variables</span></span>
<span id="cb224-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb224-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>net_tfa) <span class="co"># true observations</span></span>
<span id="cb224-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb224-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>p401) </span>
<span id="cb224-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb224-4" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pension<span class="sc">$</span>e401) </span>
<span id="cb224-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb224-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb224-6" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb224-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb224-7" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM<span class="sc">$</span><span class="fu">params_names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;ml_g0&quot; &quot;ml_g1&quot; &quot;ml_m&quot;  &quot;ml_r0&quot; &quot;ml_r1&quot;</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb226-1" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_g0) <span class="co"># predictions of g_0(z=0, X)</span></span>
<span id="cb226-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb226-2" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_g1) <span class="co"># predictions of g_0(z=1, X)</span></span>
<span id="cb226-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb226-3" aria-hidden="true" tabindex="-1"></a>g_hat <span class="ot">&lt;-</span> z<span class="sc">*</span>g1_hat<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>z)<span class="sc">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb226-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb226-4" aria-hidden="true" tabindex="-1"></a>r0_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_r0) <span class="co"># predictions of r_0(z=0, X)</span></span>
<span id="cb226-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb226-5" aria-hidden="true" tabindex="-1"></a>r1_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_r1) <span class="co"># predictions of r_0(z=1, X)</span></span>
<span id="cb226-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb226-6" aria-hidden="true" tabindex="-1"></a>r_hat <span class="ot">&lt;-</span> z<span class="sc">*</span>r1_hat<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>z)<span class="sc">*</span>r0_hat <span class="co"># predictions of r_0</span></span>
<span id="cb226-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb226-7" aria-hidden="true" tabindex="-1"></a>m_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_m) <span class="co"># predictions of m_o</span></span></code></pre></div>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb227"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb227-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variables</span></span>
<span id="cb227-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb227-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pension.net_tfa.to_numpy()</span>
<span id="cb227-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb227-3" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pension.p401.to_numpy()</span>
<span id="cb227-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb227-4" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> pension.e401.to_numpy()</span>
<span id="cb227-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb227-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb227-6" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb227-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb227-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( dml_MLIIVM.params_names )</span></code></pre></div>
<pre><code>## [&#39;ml_g0&#39;, &#39;ml_g1&#39;, &#39;ml_m&#39;, &#39;ml_r0&#39;, &#39;ml_r1&#39;]</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb229-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb229-1" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_g0&#39;</span>].flatten() <span class="co"># predictions of g_0(z=0, X)</span></span>
<span id="cb229-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb229-2" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_g1&#39;</span>].flatten() <span class="co"># predictions of g_0(z=1, X)</span></span>
<span id="cb229-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb229-3" aria-hidden="true" tabindex="-1"></a>g_hat <span class="op">=</span> d <span class="op">*</span> g1_hat <span class="op">+</span> ( <span class="dv">1</span> <span class="op">-</span> d )<span class="op">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb229-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb229-4" aria-hidden="true" tabindex="-1"></a>r0_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_r0&#39;</span>].flatten() <span class="co"># predictions of r_0(z=0, X)</span></span>
<span id="cb229-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb229-5" aria-hidden="true" tabindex="-1"></a>r1_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_r1&#39;</span>].flatten() <span class="co"># predictions of r_0(z=1, X)</span></span>
<span id="cb229-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb229-6" aria-hidden="true" tabindex="-1"></a>r_hat <span class="op">=</span> z <span class="op">*</span> r1_hat <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> z) <span class="op">*</span> r0_hat <span class="co"># predictions of r_0</span></span>
<span id="cb229-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb229-7" aria-hidden="true" tabindex="-1"></a>m_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_m&#39;</span>].flatten() <span class="co"># predictions of m_odml_MLIIVM.confint()</span></span></code></pre></div>
</div>
</div>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb230-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb230-2" aria-hidden="true" tabindex="-1"></a>lasso_y_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>g_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb230-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb230-3" aria-hidden="true" tabindex="-1"></a>lasso_y_MLIIVM</span></code></pre></div>
<pre><code>## [1] 55439.51</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb232-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb232-2" aria-hidden="true" tabindex="-1"></a>lasso_d_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>r_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb232-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb232-3" aria-hidden="true" tabindex="-1"></a>lasso_d_MLIIVM</span></code></pre></div>
<pre><code>## [1] 0.2730651</code></pre>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: instrument</span></span>
<span id="cb234-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb234-2" aria-hidden="true" tabindex="-1"></a>lasso_z_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((z<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb234-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb234-3" aria-hidden="true" tabindex="-1"></a>lasso_z_MLIIVM</span></code></pre></div>
<pre><code>## [1] 0.4440579</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb236"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb236-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb236-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb236-2" aria-hidden="true" tabindex="-1"></a>lasso_y_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> g_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb236-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( lasso_y_MLIIVM )</span>
<span id="cb236-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb236-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb236-5" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span></code></pre></div>
<pre><code>## 54127.27882639754</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb238-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb238-1" aria-hidden="true" tabindex="-1"></a>lasso_d_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> r_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb238-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( lasso_d_MLIIVM )</span>
<span id="cb238-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb238-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: instrument</span></span></code></pre></div>
<pre><code>## 0.2786204170023307</code></pre>
<div class="sourceCode" id="cb240"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb240-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb240-1" aria-hidden="true" tabindex="-1"></a>lasso_z_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( z <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb240-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( lasso_z_MLIIVM )</span></code></pre></div>
<pre><code>## 0.45851619758764794</code></pre>
</div>
</div>
<p>Again, we repeat the procedure for the other machine learning methods:</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="do">### random forest </span><span class="al">###</span></span>
<span id="cb242-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb242-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-5" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">&quot;mlr3&quot;</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">&quot;warn&quot;</span>) </span>
<span id="cb242-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-7" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM <span class="ot">=</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(data_IV_aux, </span>
<span id="cb242-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_g =</span> randomForest, </span>
<span id="cb242-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_m =</span> randomForest_class, </span>
<span id="cb242-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_r =</span> randomForest_class, </span>
<span id="cb242-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n_folds=</span><span class="dv">3</span>, </span>
<span id="cb242-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>, </span>
<span id="cb242-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-13" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">never_takers =</span> <span class="cn">TRUE</span>))</span>
<span id="cb242-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-16" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb242-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-18"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-19"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-20"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-21"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb242-21" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## p401     12386       1861   6.655 2.84e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-1" aria-hidden="true" tabindex="-1"></a>forest_MLIIVM <span class="ot">&lt;-</span> dml_MLIIVM<span class="sc">$</span>coef</span>
<span id="cb244-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-2" aria-hidden="true" tabindex="-1"></a>forest_std_MLIIVM <span class="ot">&lt;-</span> dml_MLIIVM<span class="sc">$</span>se</span>
<span id="cb244-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb244-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-6" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_g0) <span class="co"># predictions of g_0(Z=0, X)</span></span>
<span id="cb244-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-7" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_g1) <span class="co"># predictions of g_0(Z=1, X)</span></span>
<span id="cb244-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-8" aria-hidden="true" tabindex="-1"></a>g_hat <span class="ot">&lt;-</span> z<span class="sc">*</span>g1_hat<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>z)<span class="sc">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb244-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-9" aria-hidden="true" tabindex="-1"></a>r0_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_r0) <span class="co"># predictions of r_0(Z=0, X)</span></span>
<span id="cb244-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-10" aria-hidden="true" tabindex="-1"></a>r1_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_r1) <span class="co"># predictions of r_0(Z=1, X)</span></span>
<span id="cb244-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-11" aria-hidden="true" tabindex="-1"></a>r_hat <span class="ot">&lt;-</span> z<span class="sc">*</span>r1_hat<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>z)<span class="sc">*</span>r0_hat <span class="co"># predictions of r_0</span></span>
<span id="cb244-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-12" aria-hidden="true" tabindex="-1"></a>m_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_m) <span class="co"># predictions of m_o</span></span>
<span id="cb244-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-14" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb244-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-15" aria-hidden="true" tabindex="-1"></a>forest_y_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>g_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb244-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb244-16" aria-hidden="true" tabindex="-1"></a>forest_y_MLIIVM</span></code></pre></div>
<pre><code>## [1] 55894.92</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb246-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb246-2" aria-hidden="true" tabindex="-1"></a>forest_d_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>r_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb246-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb246-3" aria-hidden="true" tabindex="-1"></a>forest_d_MLIIVM</span></code></pre></div>
<pre><code>## [1] 0.281485</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: instrument</span></span>
<span id="cb248-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb248-2" aria-hidden="true" tabindex="-1"></a>forest_z_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((z<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb248-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb248-3" aria-hidden="true" tabindex="-1"></a>forest_z_MLIIVM</span></code></pre></div>
<pre><code>## [1] 0.4558207</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="do">### trees </span><span class="al">###</span></span>
<span id="cb250-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-3" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM <span class="ot">=</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(data_IV_aux, </span>
<span id="cb250-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_g =</span> trees, </span>
<span id="cb250-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_m =</span> trees_class, </span>
<span id="cb250-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_r =</span> trees_class, </span>
<span id="cb250-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n_folds=</span><span class="dv">3</span>, </span>
<span id="cb250-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>, </span>
<span id="cb250-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">never_takers =</span> <span class="cn">TRUE</span>))</span>
<span id="cb250-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-12" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb250-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb250-17" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## p401     11341       1719   6.596 4.23e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-1" aria-hidden="true" tabindex="-1"></a>tree_MLIIVM <span class="ot">&lt;-</span> dml_MLIIVM<span class="sc">$</span>coef</span>
<span id="cb252-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-2" aria-hidden="true" tabindex="-1"></a>tree_std_MLIIVM <span class="ot">&lt;-</span> dml_MLIIVM<span class="sc">$</span>se</span>
<span id="cb252-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb252-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-5" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_g0) <span class="co"># predictions of g_0(Z=0, X)</span></span>
<span id="cb252-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-6" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_g1) <span class="co"># predictions of g_0(Z=1, X)</span></span>
<span id="cb252-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-7" aria-hidden="true" tabindex="-1"></a>g_hat <span class="ot">&lt;-</span> z<span class="sc">*</span>g1_hat<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>z)<span class="sc">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb252-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-8" aria-hidden="true" tabindex="-1"></a>r0_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_r0) <span class="co"># predictions of r_0(Z=0, X)</span></span>
<span id="cb252-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-9" aria-hidden="true" tabindex="-1"></a>r1_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_r1) <span class="co"># predictions of r_0(Z=1, X)</span></span>
<span id="cb252-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-10" aria-hidden="true" tabindex="-1"></a>r_hat <span class="ot">&lt;-</span> z<span class="sc">*</span>r1_hat<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>z)<span class="sc">*</span>r0_hat <span class="co"># predictions of r_0</span></span>
<span id="cb252-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-11" aria-hidden="true" tabindex="-1"></a>m_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_m) <span class="co"># predictions of m_o</span></span>
<span id="cb252-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-13" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb252-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-14" aria-hidden="true" tabindex="-1"></a>tree_y_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>g_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb252-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb252-15" aria-hidden="true" tabindex="-1"></a>tree_y_MLIIVM</span></code></pre></div>
<pre><code>## [1] 58138.87</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb254-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb254-2" aria-hidden="true" tabindex="-1"></a>tree_d_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>r_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb254-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb254-3" aria-hidden="true" tabindex="-1"></a>tree_d_MLIIVM</span></code></pre></div>
<pre><code>## [1] 0.2780659</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: instrument</span></span>
<span id="cb256-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb256-2" aria-hidden="true" tabindex="-1"></a>tree_z_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((z<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb256-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb256-3" aria-hidden="true" tabindex="-1"></a>tree_z_MLIIVM</span></code></pre></div>
<pre><code>## [1] 0.4556836</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="do">### boosting </span><span class="al">###</span></span>
<span id="cb258-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-3" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM <span class="ot">=</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(data_IV_aux, </span>
<span id="cb258-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_g =</span> boost, </span>
<span id="cb258-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_m =</span> boost_class, </span>
<span id="cb258-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_r =</span> boost_class,</span>
<span id="cb258-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n_folds=</span><span class="dv">3</span>, </span>
<span id="cb258-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>, </span>
<span id="cb258-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">never_takers =</span> <span class="cn">TRUE</span>))</span>
<span id="cb258-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-10" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb258-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb258-14" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## p401     12529       1822   6.878 6.08e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-1" aria-hidden="true" tabindex="-1"></a>boost_MLIIVM <span class="ot">&lt;-</span> dml_MLIIVM<span class="sc">$</span>coef</span>
<span id="cb260-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-2" aria-hidden="true" tabindex="-1"></a>boost_std_MLIIVM <span class="ot">&lt;-</span> dml_MLIIVM<span class="sc">$</span>se</span>
<span id="cb260-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb260-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-5" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_g0) <span class="co"># predictions of g_0(Z=0, X)</span></span>
<span id="cb260-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-6" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_g1) <span class="co"># predictions of g_0(Z=1, X)</span></span>
<span id="cb260-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-7" aria-hidden="true" tabindex="-1"></a>g_hat <span class="ot">&lt;-</span> z<span class="sc">*</span>g1_hat<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>z)<span class="sc">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb260-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-8" aria-hidden="true" tabindex="-1"></a>r0_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_r0) <span class="co"># predictions of r_0(Z=0, X)</span></span>
<span id="cb260-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-9" aria-hidden="true" tabindex="-1"></a>r1_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_r1) <span class="co"># predictions of r_0(Z=1, X)</span></span>
<span id="cb260-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-10" aria-hidden="true" tabindex="-1"></a>r_hat <span class="ot">&lt;-</span> z<span class="sc">*</span>r1_hat<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>z)<span class="sc">*</span>r0_hat <span class="co"># predictions of r_0</span></span>
<span id="cb260-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-11" aria-hidden="true" tabindex="-1"></a>m_hat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dml_MLIIVM<span class="sc">$</span>predictions<span class="sc">$</span>ml_m) <span class="co"># predictions of m_o</span></span>
<span id="cb260-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-13" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb260-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-14" aria-hidden="true" tabindex="-1"></a>boost_y_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>g_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb260-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb260-15" aria-hidden="true" tabindex="-1"></a>boost_y_MLIIVM</span></code></pre></div>
<pre><code>## [1] 61377.34</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb262-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb262-2" aria-hidden="true" tabindex="-1"></a>boost_d_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>r_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb262-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb262-3" aria-hidden="true" tabindex="-1"></a>boost_d_MLIIVM</span></code></pre></div>
<pre><code>## [1] 0.2897971</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: instrument</span></span>
<span id="cb264-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb264-2" aria-hidden="true" tabindex="-1"></a>boost_z_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((z<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb264-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb264-3" aria-hidden="true" tabindex="-1"></a>boost_z_MLIIVM</span></code></pre></div>
<pre><code>## [1] 0.4726815</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb266"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb266-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co">### random forest </span><span class="al">###</span></span>
<span id="cb266-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-2" aria-hidden="true" tabindex="-1"></a>randomForest <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb266-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-3" aria-hidden="true" tabindex="-1"></a>randomForest_class <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb266-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-4" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb266-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-5" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM <span class="op">=</span> dml.DoubleMLIIVM(data_IV_aux,</span>
<span id="cb266-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-6" aria-hidden="true" tabindex="-1"></a>                                  ml_g <span class="op">=</span> randomForest,</span>
<span id="cb266-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-7" aria-hidden="true" tabindex="-1"></a>                                  ml_m <span class="op">=</span> randomForest_class,</span>
<span id="cb266-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-8" aria-hidden="true" tabindex="-1"></a>                                  ml_r <span class="op">=</span> randomForest_class,</span>
<span id="cb266-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-9" aria-hidden="true" tabindex="-1"></a>                                  subgroups <span class="op">=</span> {<span class="st">&#39;always_takers&#39;</span>: <span class="va">False</span>,</span>
<span id="cb266-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-10" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&#39;never_takers&#39;</span>: <span class="va">True</span>},</span>
<span id="cb266-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-11" aria-hidden="true" tabindex="-1"></a>                                  trimming_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb266-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-12" aria-hidden="true" tabindex="-1"></a>                                  n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb266-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb266-14" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM.fit(store_predictions<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_iivm.DoubleMLIIVM object at 0x0000000064929880&gt;</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb268-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( dml_MLIIVM.summary )</span></code></pre></div>
<pre><code>##               coef      std err  ...        2.5 %        97.5 %
## p401  11823.312322  2162.030668  ...  7585.810079  16060.814565
## 
## [1 rows x 6 columns]</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb270-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-1" aria-hidden="true" tabindex="-1"></a>forest_MLIIVM <span class="op">=</span> dml_MLIIVM.coef[ <span class="dv">0</span> ]</span>
<span id="cb270-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-2" aria-hidden="true" tabindex="-1"></a>forest_std_MLIIVM <span class="op">=</span> dml_MLIIVM.se[ <span class="dv">0</span> ]</span>
<span id="cb270-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb270-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-5" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_g0&#39;</span>].flatten() <span class="co"># predictions of g_0(z=0, X)</span></span>
<span id="cb270-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-6" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_g1&#39;</span>].flatten() <span class="co"># predictions of g_0(z=1, X)</span></span>
<span id="cb270-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-7" aria-hidden="true" tabindex="-1"></a>g_hat <span class="op">=</span> d <span class="op">*</span> g1_hat <span class="op">+</span> ( <span class="dv">1</span> <span class="op">-</span> d )<span class="op">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb270-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-8" aria-hidden="true" tabindex="-1"></a>r0_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_r0&#39;</span>].flatten() <span class="co"># predictions of r_0(z=0, X)</span></span>
<span id="cb270-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-9" aria-hidden="true" tabindex="-1"></a>r1_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_r1&#39;</span>].flatten() <span class="co"># predictions of r_0(z=1, X)</span></span>
<span id="cb270-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-10" aria-hidden="true" tabindex="-1"></a>r_hat <span class="op">=</span> z <span class="op">*</span> r1_hat <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> z) <span class="op">*</span> r0_hat <span class="co"># predictions of r_0</span></span>
<span id="cb270-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-11" aria-hidden="true" tabindex="-1"></a>m_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_m&#39;</span>].flatten() <span class="co"># predictions of m_o</span></span>
<span id="cb270-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-13" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb270-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-14" aria-hidden="true" tabindex="-1"></a>forest_y_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> g_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb270-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( forest_y_MLIIVM )</span>
<span id="cb270-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb270-17" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span></code></pre></div>
<pre><code>## 57014.35978884377</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb272-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb272-1" aria-hidden="true" tabindex="-1"></a>forest_d_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> r_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb272-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( forest_d_MLIIVM )</span>
<span id="cb272-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb272-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: instrument</span></span></code></pre></div>
<pre><code>## 0.28397007364006993</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb274-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb274-1" aria-hidden="true" tabindex="-1"></a>forest_z_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( z <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb274-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( forest_z_MLIIVM )</span>
<span id="cb274-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb274-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb274-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb274-5" aria-hidden="true" tabindex="-1"></a><span class="co">### trees </span><span class="al">###</span></span></code></pre></div>
<pre><code>## 0.46312674664653625</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb276-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb276-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb276-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb276-2" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM <span class="op">=</span> dml.DoubleMLIIVM(data_IV_aux,</span>
<span id="cb276-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb276-3" aria-hidden="true" tabindex="-1"></a>                                  ml_g <span class="op">=</span> trees,</span>
<span id="cb276-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb276-4" aria-hidden="true" tabindex="-1"></a>                                  ml_m <span class="op">=</span> trees_class,</span>
<span id="cb276-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb276-5" aria-hidden="true" tabindex="-1"></a>                                  ml_r <span class="op">=</span> trees_class,</span>
<span id="cb276-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb276-6" aria-hidden="true" tabindex="-1"></a>                                  subgroups <span class="op">=</span> {<span class="st">&#39;always_takers&#39;</span>: <span class="va">False</span>,</span>
<span id="cb276-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb276-7" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&#39;never_takers&#39;</span>: <span class="va">True</span>},</span>
<span id="cb276-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb276-8" aria-hidden="true" tabindex="-1"></a>                                  trimming_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb276-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb276-9" aria-hidden="true" tabindex="-1"></a>                                  n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb276-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb276-10" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM.fit(store_predictions<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_iivm.DoubleMLIIVM object at 0x00000000649291F0&gt;</code></pre>
<div class="sourceCode" id="cb278"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb278-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( dml_MLIIVM.summary )</span></code></pre></div>
<pre><code>##               coef      std err  ...        2.5 %        97.5 %
## p401  10652.033245  1665.615224  ...  7387.487395  13916.579095
## 
## [1 rows x 6 columns]</code></pre>
<div class="sourceCode" id="cb280"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb280-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-1" aria-hidden="true" tabindex="-1"></a>tree_MLIIVM <span class="op">=</span> dml_MLIIVM.coef[ <span class="dv">0</span> ]</span>
<span id="cb280-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-2" aria-hidden="true" tabindex="-1"></a>tree_std_MLIIVM <span class="op">=</span> dml_MLIIVM.se[ <span class="dv">0</span> ]</span>
<span id="cb280-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-5" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb280-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-6" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_g0&#39;</span>].flatten() <span class="co"># predictions of g_0(z=0, X)</span></span>
<span id="cb280-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-7" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_g1&#39;</span>].flatten() <span class="co"># predictions of g_0(z=1, X)</span></span>
<span id="cb280-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-8" aria-hidden="true" tabindex="-1"></a>g_hat <span class="op">=</span> d <span class="op">*</span> g1_hat <span class="op">+</span> ( <span class="dv">1</span> <span class="op">-</span> d )<span class="op">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb280-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-9" aria-hidden="true" tabindex="-1"></a>r0_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_r0&#39;</span>].flatten() <span class="co"># predictions of r_0(z=0, X)</span></span>
<span id="cb280-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-10" aria-hidden="true" tabindex="-1"></a>r1_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_r1&#39;</span>].flatten() <span class="co"># predictions of r_0(z=1, X)</span></span>
<span id="cb280-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-11" aria-hidden="true" tabindex="-1"></a>r_hat <span class="op">=</span> z <span class="op">*</span> r1_hat <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> z) <span class="op">*</span> r0_hat <span class="co"># predictions of r_0</span></span>
<span id="cb280-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-12" aria-hidden="true" tabindex="-1"></a>m_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_m&#39;</span>].flatten() <span class="co"># predictions of m_o</span></span>
<span id="cb280-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-14" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb280-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-15" aria-hidden="true" tabindex="-1"></a>tree_y_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> g_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb280-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( tree_y_MLIIVM )</span>
<span id="cb280-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-18"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb280-18" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span></code></pre></div>
<pre><code>## 56317.410732152974</code></pre>
<div class="sourceCode" id="cb282"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb282-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb282-1" aria-hidden="true" tabindex="-1"></a>tree_d_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> r_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb282-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( tree_d_MLIIVM )</span>
<span id="cb282-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb282-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb282-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: instrument</span></span></code></pre></div>
<pre><code>## 0.278215621782697</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb284-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb284-1" aria-hidden="true" tabindex="-1"></a>tree_z_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( z <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb284-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( tree_z_MLIIVM )</span>
<span id="cb284-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb284-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb284-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb284-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb284-6" aria-hidden="true" tabindex="-1"></a><span class="co">### boosting </span><span class="al">###</span></span></code></pre></div>
<pre><code>## 0.4546690531536573</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb286-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb286-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb286-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb286-2" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM <span class="op">=</span> dml.DoubleMLIIVM(data_IV_aux,</span>
<span id="cb286-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb286-3" aria-hidden="true" tabindex="-1"></a>                                  ml_g <span class="op">=</span> boost,</span>
<span id="cb286-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb286-4" aria-hidden="true" tabindex="-1"></a>                                  ml_m <span class="op">=</span> boost_class,</span>
<span id="cb286-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb286-5" aria-hidden="true" tabindex="-1"></a>                                  ml_r <span class="op">=</span> boost_class,</span>
<span id="cb286-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb286-6" aria-hidden="true" tabindex="-1"></a>                                  subgroups <span class="op">=</span> {<span class="st">&#39;always_takers&#39;</span>: <span class="va">False</span>,</span>
<span id="cb286-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb286-7" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&#39;never_takers&#39;</span>: <span class="va">True</span>},</span>
<span id="cb286-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb286-8" aria-hidden="true" tabindex="-1"></a>                                  trimming_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb286-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb286-9" aria-hidden="true" tabindex="-1"></a>                                  n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb286-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb286-10" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM.fit(store_predictions<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_iivm.DoubleMLIIVM object at 0x000000000C669B20&gt;</code></pre>
<div class="sourceCode" id="cb288"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb288-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( dml_MLIIVM.summary )</span></code></pre></div>
<pre><code>##               coef      std err         t     P&gt;|t|        2.5 %        97.5 %
## p401  13593.184614  3490.834608  3.893964  0.000099  6751.274506  20435.094721</code></pre>
<div class="sourceCode" id="cb290"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb290-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-1" aria-hidden="true" tabindex="-1"></a>boost_MLIIVM <span class="op">=</span> dml_MLIIVM.coef[ <span class="dv">0</span> ]</span>
<span id="cb290-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-2" aria-hidden="true" tabindex="-1"></a>boost_std_MLIIVM <span class="op">=</span> dml_MLIIVM.se[ <span class="dv">0</span> ]</span>
<span id="cb290-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-5" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb290-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-6" aria-hidden="true" tabindex="-1"></a>g0_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_g0&#39;</span>].flatten() <span class="co"># predictions of g_0(z=0, X)</span></span>
<span id="cb290-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-7" aria-hidden="true" tabindex="-1"></a>g1_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_g1&#39;</span>].flatten() <span class="co"># predictions of g_0(z=1, X)</span></span>
<span id="cb290-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-8" aria-hidden="true" tabindex="-1"></a>g_hat <span class="op">=</span> d <span class="op">*</span> g1_hat <span class="op">+</span> ( <span class="dv">1</span> <span class="op">-</span> d )<span class="op">*</span>g0_hat <span class="co"># predictions of g_0</span></span>
<span id="cb290-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-9" aria-hidden="true" tabindex="-1"></a>r0_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_r0&#39;</span>].flatten() <span class="co"># predictions of r_0(z=0, X)</span></span>
<span id="cb290-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-10" aria-hidden="true" tabindex="-1"></a>r1_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_r1&#39;</span>].flatten() <span class="co"># predictions of r_0(z=1, X)</span></span>
<span id="cb290-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-11" aria-hidden="true" tabindex="-1"></a>r_hat <span class="op">=</span> z <span class="op">*</span> r1_hat <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> z) <span class="op">*</span> r0_hat <span class="co"># predictions of r_0</span></span>
<span id="cb290-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-12" aria-hidden="true" tabindex="-1"></a>m_hat <span class="op">=</span> dml_MLIIVM.predictions[<span class="st">&#39;ml_m&#39;</span>].flatten() <span class="co"># predictions of m_o</span></span>
<span id="cb290-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-14" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb290-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-15" aria-hidden="true" tabindex="-1"></a>boost_y_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> g_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb290-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( boost_y_MLIIVM )</span>
<span id="cb290-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-18"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb290-18" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span></code></pre></div>
<pre><code>## 61407.11615253673</code></pre>
<div class="sourceCode" id="cb292"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb292-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb292-1" aria-hidden="true" tabindex="-1"></a>boost_d_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> r_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb292-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( boost_d_MLIIVM )</span>
<span id="cb292-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb292-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb292-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: instrument</span></span></code></pre></div>
<pre><code>## 0.2960100530837048</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb294-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb294-1" aria-hidden="true" tabindex="-1"></a>boost_z_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( z <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb294-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( boost_z_MLIIVM )</span></code></pre></div>
<pre><code>## 0.46296289075787445</code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb296-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb296-2" aria-hidden="true" tabindex="-1"></a>lasso_y_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>g_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb296-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb296-3" aria-hidden="true" tabindex="-1"></a>lasso_y_MLIIVM</span></code></pre></div>
<pre><code>## [1] 61377.34</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span>
<span id="cb298-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb298-2" aria-hidden="true" tabindex="-1"></a>lasso_d_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((d<span class="sc">-</span>r_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb298-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb298-3" aria-hidden="true" tabindex="-1"></a>lasso_d_MLIIVM</span></code></pre></div>
<pre><code>## [1] 0.2897971</code></pre>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: instrument</span></span>
<span id="cb300-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb300-2" aria-hidden="true" tabindex="-1"></a>lasso_z_MLIIVM <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((z<span class="sc">-</span>m_hat)<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb300-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb300-3" aria-hidden="true" tabindex="-1"></a>lasso_z_MLIIVM</span></code></pre></div>
<pre><code>## [1] 0.4726815</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb302"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb302-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: outcome</span></span>
<span id="cb302-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb302-2" aria-hidden="true" tabindex="-1"></a>lasso_y_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( y <span class="op">-</span> g_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb302-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb302-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( lasso_y_MLIIVM )</span>
<span id="cb302-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb302-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb302-5" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: treatment</span></span></code></pre></div>
<pre><code>## 61407.11615253673</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb304-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb304-1" aria-hidden="true" tabindex="-1"></a>lasso_d_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( d <span class="op">-</span> r_hat ) <span class="op">**</span> <span class="dv">2</span> ) )</span>
<span id="cb304-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb304-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( lasso_d_MLIIVM )</span>
<span id="cb304-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb304-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb304-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-fitted RMSE: instrument</span></span></code></pre></div>
<pre><code>## 0.2960100530837048</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb306-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb306-1" aria-hidden="true" tabindex="-1"></a>lasso_z_MLIIVM <span class="op">=</span> np.sqrt( np.mean( ( z <span class="op">-</span> m_hat ) <span class="op">**</span> <span class="dv">2</span> ) ) </span>
<span id="cb306-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb306-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( lasso_z_MLIIVM )</span></code></pre></div>
<pre><code>## 0.46296289075787445</code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xtable)</span>
<span id="cb308-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb308-2" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">4</span>)</span>
<span id="cb308-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb308-3" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_MLIIVM,forest_MLIIVM,tree_MLIIVM,boost_MLIIVM)</span>
<span id="cb308-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb308-4" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_std_MLIIVM,forest_std_MLIIVM,tree_std_MLIIVM,boost_std_MLIIVM)</span>
<span id="cb308-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb308-5" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">3</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_y_MLIIVM,forest_y_MLIIVM,tree_y_MLIIVM,boost_y_MLIIVM)</span>
<span id="cb308-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb308-6" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">4</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_d_MLIIVM,forest_d_MLIIVM,tree_d_MLIIVM,boost_d_MLIIVM)</span>
<span id="cb308-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb308-7" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]   <span class="ot">&lt;-</span> <span class="fu">c</span>(lasso_z_MLIIVM,forest_z_MLIIVM,tree_z_MLIIVM,boost_z_MLIIVM)</span>
<span id="cb308-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb308-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Estimate&quot;</span>,<span class="st">&quot;Std.Error&quot;</span>,<span class="st">&quot;RMSE Y&quot;</span>,<span class="st">&quot;RMSE D&quot;</span>,<span class="st">&quot;RMSE Z&quot;</span>)</span>
<span id="cb308-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb308-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Lasso&quot;</span>,<span class="st">&quot;Random Forest&quot;</span>,<span class="st">&quot;Trees&quot;</span>,<span class="st">&quot;Boosting&quot;</span>)</span>
<span id="cb308-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb308-10" aria-hidden="true" tabindex="-1"></a>tab<span class="ot">&lt;-</span> <span class="fu">xtable</span>(table, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb308-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb308-11" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div>
<pre><code>## % latex table generated in R 4.0.4 by xtable 1.8-4 package
## % Wed Nov 24 15:13:38 2021
## \begin{table}[ht]
## \centering
## \begin{tabular}{rrrrr}
##   \hline
##  &amp; Lasso &amp; Random Forest &amp; Trees &amp; Boosting \\ 
##   \hline
## Estimate &amp; 11484.48 &amp; 12385.92 &amp; 11340.90 &amp; 12529.11 \\ 
##   Std.Error &amp; 1596.17 &amp; 1861.19 &amp; 1719.41 &amp; 1821.69 \\ 
##   RMSE Y &amp; 61377.34 &amp; 55894.92 &amp; 58138.87 &amp; 61377.34 \\ 
##   RMSE D &amp; 0.29 &amp; 0.28 &amp; 0.28 &amp; 0.29 \\ 
##   RMSE Z &amp; 0.47 &amp; 0.46 &amp; 0.46 &amp; 0.47 \\ 
##    \hline
## \end{tabular}
## \end{table}</code></pre>
</div><div class="column" style="width:1%;">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div><div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb310"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb310-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb310-1" aria-hidden="true" tabindex="-1"></a>table3 <span class="op">=</span> np.zeros( (<span class="dv">5</span>, <span class="dv">4</span>) )</span>
<span id="cb310-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb310-2" aria-hidden="true" tabindex="-1"></a>table3[<span class="dv">0</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_MLIIVM,forest_MLIIVM,tree_MLIIVM,boost_MLIIVM</span>
<span id="cb310-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb310-3" aria-hidden="true" tabindex="-1"></a>table3[<span class="dv">1</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_std_MLIIVM,forest_std_MLIIVM,tree_std_MLIIVM,boost_std_MLIIVM</span>
<span id="cb310-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb310-4" aria-hidden="true" tabindex="-1"></a>table3[<span class="dv">2</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_y_MLIIVM,forest_y_MLIIVM,tree_y_MLIIVM,boost_y_MLIIVM</span>
<span id="cb310-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb310-5" aria-hidden="true" tabindex="-1"></a>table3[<span class="dv">3</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_d_MLIIVM,forest_d_MLIIVM,tree_d_MLIIVM,boost_d_MLIIVM</span>
<span id="cb310-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb310-6" aria-hidden="true" tabindex="-1"></a>table3[<span class="dv">4</span>,<span class="dv">0</span>:<span class="dv">4</span>] <span class="op">=</span> lasso_z_MLIIVM,forest_z_MLIIVM,tree_z_MLIIVM,boost_z_MLIIVM</span>
<span id="cb310-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb310-7" aria-hidden="true" tabindex="-1"></a>table3_pd <span class="op">=</span> pd.DataFrame( table3 , </span>
<span id="cb310-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb310-8" aria-hidden="true" tabindex="-1"></a>                  index <span class="op">=</span> [<span class="st">&quot;Estimate&quot;</span>,<span class="st">&quot;Std.Error&quot;</span>,<span class="st">&quot;RMSE Y&quot;</span>,<span class="st">&quot;RMSE D&quot;</span>,<span class="st">&quot;RMSE Z&quot;</span> ], <span class="op">\</span></span>
<span id="cb310-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb310-9" aria-hidden="true" tabindex="-1"></a>                columns <span class="op">=</span> [ <span class="st">&quot;Lasso&quot;</span>,<span class="st">&quot;Random Forest&quot;</span>,<span class="st">&quot;Trees&quot;</span>,<span class="st">&quot;Boosting&quot;</span>])</span>
<span id="cb310-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb310-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb310-11" aria-hidden="true" tabindex="-1"></a>table3_pd.to_latex()</span></code></pre></div>
<pre><code>## &#39;\\begin{tabular}{lrrrr}\n\\toprule\n{} &amp;         Lasso &amp;  Random Forest &amp;         Trees &amp;      Boosting \\\\\n\\midrule\nEstimate  &amp;  11764.551405 &amp;   11823.312322 &amp;  10652.033245 &amp;  13593.184614 \\\\\nStd.Error &amp;   1842.601194 &amp;    2162.030668 &amp;   1665.615224 &amp;   3490.834608 \\\\\nRMSE Y    &amp;  61407.116153 &amp;   57014.359789 &amp;  56317.410732 &amp;  61407.116153 \\\\\nRMSE D    &amp;      0.296010 &amp;       0.283970 &amp;      0.278216 &amp;      0.296010 \\\\\nRMSE Z    &amp;      0.462963 &amp;       0.463127 &amp;      0.454669 &amp;      0.462963 \\\\\n\\bottomrule\n\\end{tabular}\n&#39;</code></pre>
</div>
</div>
<p>We report results based on four ML methods for estimating the nuisance functions used in
forming the orthogonal estimating equations. We find again that the estimates of the treatment effect are stable across ML methods. The estimates are highly significant, hence we would reject the hypothesis
that the effect of 401(k) participation has no effect on financial health.</p>
<p>We might rerun the model using the best ML method for each equation to get a final estimate for the treatment effect of participation:</p>
<div class="columns">
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb312-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-2" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">&quot;mlr3&quot;</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">&quot;warn&quot;</span>) </span>
<span id="cb312-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-3" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM <span class="ot">=</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(data_IV_aux, </span>
<span id="cb312-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_g =</span> randomForest, </span>
<span id="cb312-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_m =</span> lasso_class, </span>
<span id="cb312-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_r =</span> lasso_class,</span>
<span id="cb312-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n_folds=</span><span class="dv">3</span>, </span>
<span id="cb312-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>, </span>
<span id="cb312-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">never_takers =</span> <span class="cn">TRUE</span>))</span>
<span id="cb312-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-12"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-13"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-13" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions=</span><span class="cn">TRUE</span>)</span>
<span id="cb312-14"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-15"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-16"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-17"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb312-17" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Estimates and significance testing of the effect of target variables&quot;
##      Estimate. Std. Error t value Pr(&gt;|t|)    
## p401     11984       1612   7.433 1.06e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb314-1" aria-hidden="true" tabindex="-1"></a>best_MLIIVM <span class="ot">&lt;-</span> dml_MLIIVM<span class="sc">$</span>coef</span>
<span id="cb314-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb314-2" aria-hidden="true" tabindex="-1"></a>best_std_MLIIVM <span class="ot">&lt;-</span> dml_MLIIVM<span class="sc">$</span>se</span></code></pre></div>
</div><p>::: {.column width=“1%” datI a-latex=“{0.04}”}
 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="column" style="width:49.5%;">
<div class="sourceCode" id="cb315"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb315-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Random best</span></span>
<span id="cb315-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb315-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb315-3"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb315-3" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM <span class="op">=</span> dml.DoubleMLIIVM(data_IV_aux,</span>
<span id="cb315-4"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb315-4" aria-hidden="true" tabindex="-1"></a>                                  ml_g <span class="op">=</span> randomForest,</span>
<span id="cb315-5"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb315-5" aria-hidden="true" tabindex="-1"></a>                                  ml_m <span class="op">=</span> lasso_class,</span>
<span id="cb315-6"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb315-6" aria-hidden="true" tabindex="-1"></a>                                  ml_r <span class="op">=</span> lasso_class,</span>
<span id="cb315-7"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb315-7" aria-hidden="true" tabindex="-1"></a>                                  subgroups <span class="op">=</span> {<span class="st">&#39;always_takers&#39;</span>: <span class="va">False</span>,</span>
<span id="cb315-8"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb315-8" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&#39;never_takers&#39;</span>: <span class="va">True</span>},</span>
<span id="cb315-9"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb315-9" aria-hidden="true" tabindex="-1"></a>                                  trimming_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb315-10"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb315-10" aria-hidden="true" tabindex="-1"></a>                                  n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb315-11"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb315-11" aria-hidden="true" tabindex="-1"></a>dml_MLIIVM.fit(store_predictions<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>## &lt;doubleml.double_ml_iivm.DoubleMLIIVM object at 0x000000000C654A00&gt;</code></pre>
<div class="sourceCode" id="cb317"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb317-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( dml_MLIIVM.summary )</span></code></pre></div>
<pre><code>##               coef      std err  ...       2.5 %        97.5 %
## p401  12220.624723  1957.387719  ...  8384.21529  16057.034157
## 
## [1 rows x 6 columns]</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb319-1"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb319-1" aria-hidden="true" tabindex="-1"></a>best_MLIIVM <span class="op">=</span> dml_MLIIVM.coef[ <span class="dv">0</span> ]</span>
<span id="cb319-2"><a href="inference-on-predictive-and-causal-effects-in-high-dimensional-nonlinear-models.html#cb319-2" aria-hidden="true" tabindex="-1"></a>best_std_MLIIVM <span class="op">=</span> dml_MLIIVM.se[ <span class="dv">0</span> ]</span></code></pre></div>
</div>
<p>::::::
</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-effect-of-gun-ownership-on-gun-homicide-rates-using-dml-for-neural-nets.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="using-dagitty-in-the-analysis-of-impact-of-401k-on-net-financial-wealth.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/alexanderquispe/ml_book/edit/master/26-DML-for-ATE-and-Late.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/alexanderquispe/ml_book/blob/master/26-DML-for-ATE-and-Late.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
